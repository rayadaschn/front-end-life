import{_ as p,X as o,Z as l,$ as c,V as i,W as u,F as r,Y as d}from"./framework-2eee3422.js";const k={},n=o,s=l,v=r,t=c,e=d,m=i,g=u,b=e(`<h1 id="nuxt-3-之基础入门" tabindex="-1"><a class="header-anchor" href="#nuxt-3-之基础入门" aria-hidden="true">#</a> Nuxt 3 之基础入门</h1><h2 id="路由" tabindex="-1"><a class="header-anchor" href="#路由" aria-hidden="true">#</a> 路由</h2><p>不同于常规的 Vue 项目是以 <code>index.js</code> 为项目的入口文件，Nuxt 将 <code>App.vue</code> 作为文件入口点，并为应用程序的每个路由展示内容。这是 Nuxt 的一个核心特性是文件系统路由器。<code>pages/</code> 目录中的每个 Vue 文件都会创建一个相应的 URL(或路由)来显示文件的内容。</p><blockquote><p>路由的嵌套: 路由的嵌套则直接是文件夹形式：pages 文件夹下新建子文件夹。</p></blockquote><ol><li><p>路由的占位：</p><p>同 Vue 一样，Nuxt 也是通过路由占位切换不同的页面。在 Vue 中是通过 <code>RouterView</code> ，而 Nuxt 为 <code>NuxtPage</code>。</p></li><li><p>路由的切换:</p><p>通常在 Nuxt 中是通过 <code>&lt;NuxtLink&gt;</code> 组件在它们之间链接页面。它呈现一个 <code>&lt;a&gt;</code> 标记，其中 href 属性设置为页面的路由。</p><p>当然可以通过 <code>navigateTo</code> 或者 <code>useRouter</code> 等函数式编程进行路由切换，但是这不利于 SEO 的解析。此时效果等同于 SPA 。</p></li><li><p>路由参数 params:</p><p>通过 <code>useRoute</code> 可以获取路由参数。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token operator">&lt;</span>script setup<span class="token operator">&gt;</span>
  <span class="token keyword">const</span> route <span class="token operator">=</span> <span class="token function">useRoute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 当访问 /posts/1, route.params.id 值为 1</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>route<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>导航守卫: 中间件 Middleware</p><p>在 Nuxt 中有一个中间件 Middleware 的概念。实际上就是导航守卫的作用。使用流程如下：</p><ul><li><p>创建 middleware 文件</p><p>在 Nuxt 项目中，在 <code>middleware</code> 目录下创建一个新的 JavaScript 文件。该文件将包含所有的 middleware 代码。例如，可以创建一个名为 <code>auth.js</code> 的新文件：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// auth.js</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> store<span class="token punctuation">,</span> redirect <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 如果用户未经身份验证，则重定向到登录页面</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>loggedIn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">&#39;/login&#39;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的代码中，我们定义了一个名为 <code>auth</code> 的 middleware，用于确保用户已经登录。如果用户未经身份验证，则该函数将使用 <code>redirect</code> 方法将用户重定向到登录页面。</p></li><li><p>注册 middleware</p><p>在 Nuxt 中，可以在路由配置对象或页面组件中注册 middleware。例如，可以在 <code>nuxt.config.js</code> 文件中为全局路由注册 middleware：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">router</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">middleware</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;auth&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的代码中，我们将 <code>auth</code> middleware 注册为全局路由 middleware。这意味着每个路由都将使用该 middleware。</p><p>此外，我们还可以在路由配置对象或页面组件中注册 middleware。在页面组件中注册 middleware：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// page/xxx.vue</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">middleware</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;auth&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的代码中，我们将 <code>auth</code> middleware 注册为该页面组件的 middleware。这意味着该页面将使用该 middleware。</p></li><li><p>使用 middleware</p><p>现在，当用户访问需要身份验证的页面时，middleware 将运行并检查用户是否已经登录。如果用户未经身份验证，则 middleware 将将用户重定向到登录页面。</p><p>这就是使用 middleware 的基本步骤。你可以使用 middleware 完成许多任务，例如身份验证、页面初始化、请求处理、性能指标跟踪等。在编写 middleware 时，请记住将其注册到正确的路由或页面上，并在 middleware 函数中执行必要的逻辑。</p></li></ul></li></ol><h2 id="生命周期" tabindex="-1"><a class="header-anchor" href="#生命周期" aria-hidden="true">#</a> 生命周期</h2><p>Nuxt 的生命周期，全交由 Hooks 进行管理，先梳理一下：</p>`,7),y=n("thead",null,[n("tr",null,[n("th",{style:{"text-align":"left"}},"Hook"),n("th",{style:{"text-align":"left"}},"Arguments"),n("th",{style:{"text-align":"left"}},"Environment"),n("th",{style:{"text-align":"left"}},"Description")])],-1),f=n("tr",null,[n("td",{style:{"text-align":"left"}},[n("code",null,"app:created")]),n("td",{style:{"text-align":"left"}},[n("code",null,"vueApp")]),n("td",{style:{"text-align":"left"}},"Server & Client"),n("td",{style:{"text-align":"left"}},[s("创建初始"),n("code",null,"vueApp"),s(" 实例时调用。")])],-1),h=n("tr",null,[n("td",{style:{"text-align":"left"}},[n("code",null,"app:error")]),n("td",{style:{"text-align":"left"}},[n("code",null,"err")]),n("td",{style:{"text-align":"left"}},"Server & Client"),n("td",{style:{"text-align":"left"}},"发生致命错误时调用。")],-1),x=n("tr",null,[n("td",{style:{"text-align":"left"}},[n("code",null,"app:error:cleared")]),n("td",{style:{"text-align":"left"}},[n("code",null,"{ redirect? }")]),n("td",{style:{"text-align":"left"}},"Server & Client"),n("td",{style:{"text-align":"left"}},"发生致命错误时调用。")],-1),_=n("tr",null,[n("td",{style:{"text-align":"left"}},[n("code",null,"app:data:refresh")]),n("td",{style:{"text-align":"left"}},[n("code",null,"keys?")]),n("td",{style:{"text-align":"left"}},"Server & Client"),n("td",{style:{"text-align":"left"}},"(internal)")],-1),w=n("tr",null,[n("td",{style:{"text-align":"left"}},[n("code",null,"vue:setup")]),n("td",{style:{"text-align":"left"}},"-"),n("td",{style:{"text-align":"left"}},"Server & Client"),n("td",{style:{"text-align":"left"}},"(internal)")],-1),j=n("tr",null,[n("td",{style:{"text-align":"left"}},[n("code",null,"vue:error")]),n("td",{style:{"text-align":"left"}},[n("code",null,"err, target, info")]),n("td",{style:{"text-align":"left"}},"Server & Client"),n("td",{style:{"text-align":"left"}},"当 vue 错误跳转到根组件时调用。")],-1),q=n("tr",null,[n("td",{style:{"text-align":"left"}},[n("code",null,"app:rendered")]),n("td",{style:{"text-align":"left"}},[n("code",null,"renderContext")]),n("td",{style:{"text-align":"left"}},"Server"),n("td",{style:{"text-align":"left"}},"在 SSR 渲染完成时调用。")],-1),A=n("tr",null,[n("td",{style:{"text-align":"left"}},[n("code",null,"app:redirected")]),n("td",{style:{"text-align":"left"}},"-"),n("td",{style:{"text-align":"left"}},"Server"),n("td",{style:{"text-align":"left"}},"在 SSR 重定向之前调用。")],-1),S=n("tr",null,[n("td",{style:{"text-align":"left"}},[n("code",null,"app:beforeMount")]),n("td",{style:{"text-align":"left"}},[n("code",null,"vueApp")]),n("td",{style:{"text-align":"left"}},"Client"),n("td",{style:{"text-align":"left"}},"在安装应用程序之前调用，仅在客户端调用。")],-1),T=n("tr",null,[n("td",{style:{"text-align":"left"}},[n("code",null,"app:mounted")]),n("td",{style:{"text-align":"left"}},[n("code",null,"vueApp")]),n("td",{style:{"text-align":"left"}},"Client"),n("td",{style:{"text-align":"left"}},"Vue 应用程序初始化并 mounted 浏览器时调用。")],-1),C=n("td",{style:{"text-align":"left"}},[n("code",null,"app:suspense:resolve")],-1),N=n("td",{style:{"text-align":"left"}},[n("code",null,"appComponent")],-1),R=n("td",{style:{"text-align":"left"}},"Client",-1),O={style:{"text-align":"left"}},U={href:"https://vuejs.org/guide/built-ins/suspense.html#suspense",target:"_blank",rel:"noopener noreferrer"},F=n("tr",null,[n("td",{style:{"text-align":"left"}},[n("code",null,"link:prefetch")]),n("td",{style:{"text-align":"left"}},[n("code",null,"to")]),n("td",{style:{"text-align":"left"}},"Client"),n("td",{style:{"text-align":"left"}},[s("当观察到"),n("code",null,"<NuxtLink>"),s(" 被预取时调用。")])],-1),L=n("td",{style:{"text-align":"left"}},[n("code",null,"page:start")],-1),E=n("td",{style:{"text-align":"left"}},[n("code",null,"pageComponent?")],-1),V=n("td",{style:{"text-align":"left"}},"Client",-1),P={style:{"text-align":"left"}},D={href:"https://vuejs.org/guide/built-ins/suspense.html#suspense",target:"_blank",rel:"noopener noreferrer"},B=n("td",{style:{"text-align":"left"}},[n("code",null,"page:finish")],-1),M=n("td",{style:{"text-align":"left"}},[n("code",null,"pageComponent?")],-1),H=n("td",{style:{"text-align":"left"}},"Client",-1),z={style:{"text-align":"left"}},G={href:"https://vuejs.org/guide/built-ins/suspense.html#suspense",target:"_blank",rel:"noopener noreferrer"},I=n("td",{style:{"text-align":"left"}},[n("code",null,"page:transition:finish")],-1),$=n("td",{style:{"text-align":"left"}},[n("code",null,"pageComponent?")],-1),J=n("td",{style:{"text-align":"left"}},"Client",-1),W={style:{"text-align":"left"}},X={href:"https://vuejs.org/guide/built-ins/transition.html#javascript-hooks",target:"_blank",rel:"noopener noreferrer"},Y=e(`<p>语法：<code>nuxtApp.hook(app:created, func)</code></p><p>使用方法也很简单:</p><p>在 <code>nuxt.config.ts</code> 全局生命周期:</p><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineNuxtConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  hooks<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">setup</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在页面中使用:</p><div class="language-vue line-numbers-mode" data-ext="vue"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>NuxtPage</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>NuxtPage</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">const</span> nuxtApp <span class="token operator">=</span> <span class="token function">useNuxtApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// Server &amp; Client</span>
nuxtApp<span class="token punctuation">.</span><span class="token function">hook</span><span class="token punctuation">(</span><span class="token string">&#39;app:created&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">vueApp</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// console.log(&quot;app:created&quot;);</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// Client</span>
nuxtApp<span class="token punctuation">.</span><span class="token function">hook</span><span class="token punctuation">(</span><span class="token string">&#39;app:beforeMount&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">vueApp</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// console.log(&quot;app:beforeMount&quot;);</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// Server &amp; Client</span>
nuxtApp<span class="token punctuation">.</span><span class="token function">hook</span><span class="token punctuation">(</span><span class="token string">&#39;vue:setup&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// console.log(&quot;vue:setup&quot;);</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// Server</span>
nuxtApp<span class="token punctuation">.</span><span class="token function">hook</span><span class="token punctuation">(</span><span class="token string">&#39;app:rendered&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">renderContext</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// console.log(&quot;app:rendered&quot;);</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// Client</span>
nuxtApp<span class="token punctuation">.</span><span class="token function">hook</span><span class="token punctuation">(</span><span class="token string">&#39;app:mounted&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">vueApp</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// console.log(&quot;app:mounted&quot;);</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="获取数据" tabindex="-1"><a class="header-anchor" href="#获取数据" aria-hidden="true">#</a> 获取数据</h2><ol><li><p>useAsyncData(key, func, options):专门解决异步获取数据的函数，会阻止页面导航。</p><ul><li>key： string 类型，不可重复</li><li>func ：实际请求函数</li><li>options：请求配置参数</li></ul><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> data<span class="token punctuation">,</span> pending<span class="token punctuation">,</span> error<span class="token punctuation">,</span> refresh <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">useAsyncData</span><span class="token punctuation">(</span>
  <span class="token string">&#39;mountains&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">$fetch</span><span class="token punctuation">(</span><span class="token string">&#39;https://api.nuxtjs.dev/mountains&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>useFetch(url, opts):用于获取任意的 URL 地址的数据，会阻止页面导航</p><ul><li>本质是 useAsyncData(key, () =&gt; $fetch(url, opts)) 的语法糖。</li></ul><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> data<span class="token punctuation">,</span> pending<span class="token punctuation">,</span> error<span class="token punctuation">,</span> refresh <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">useFetch</span><span class="token punctuation">(</span>
  <span class="token string">&#39;https://api.nuxtjs.dev/mountains&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">pick</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;title&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>useLazyFetch(url, opts):用于获取任意 URL 数据，不会阻止页面导航</p><ul><li>本质和 useFetch 的 lazy 属性设置为 true 一样</li><li>opts 有如下选项: <ul><li>method: 请求方法;</li><li>query: 向 URL 添加查询搜索参数;</li><li>params: 参数别名;</li><li>body: 请求主体, 若传递的是对象则会将其自动字符串化;</li><li>headers: 请求头;</li><li>baseURL: Base URL。</li></ul></li></ul></li><li><p>useLazyAsyncData(key, func):专门解决异步获取数据的函数。 不会阻止页面导航</p><ul><li>本质和 useAsyncData 的 lazy 属性设置为 true 一样</li></ul></li></ol><p><strong>封装 useFetch 请求函数</strong>:</p><ul><li><p>在 service 文件夹下新建一个 index.ts 的基础请求函数类：</p><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">class</span> <span class="token class-name">HuyRequest</span> <span class="token punctuation">{</span>
  <span class="token generic-function"><span class="token function">request</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token builtin">any</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token function">Promise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token generic-function"><span class="token function">get</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token builtin">any</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token generic-function"><span class="token function">post</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token builtin">any</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>基础请求方法由 request 实现，而对外只需定义实际应用的 get 和 post 方法。</p></li><li><p>先看 get 和 post 对 request 的实际需求：仅需要定义请求的 url 便可发起请求，而后是请求参数和 fetch 相关的 options；</p><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> UseFetchOptions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;nuxt/dist/app/composables&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">HuyRequest</span> <span class="token punctuation">{</span>
  <span class="token generic-function"><span class="token function">request</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token builtin">any</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token function">Promise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token generic-function"><span class="token function">get</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token builtin">any</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>url<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> params<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> options<span class="token operator">?</span><span class="token operator">:</span> UseFetchOptions<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token string">&quot;GET&quot;</span><span class="token punctuation">,</span> params<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token generic-function"><span class="token function">post</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token builtin">any</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>url<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> data<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> options<span class="token operator">?</span><span class="token operator">:</span> UseFetchOptions<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span> data<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>最终完善 class：</p><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> AsyncData<span class="token punctuation">,</span> UseFetchOptions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;nuxt/dist/app/composables&#39;</span>

<span class="token keyword">type</span> <span class="token class-name">Methods</span> <span class="token operator">=</span> <span class="token string">&#39;GET&#39;</span> <span class="token operator">|</span> <span class="token string">&#39;POST&#39;</span>

<span class="token keyword">const</span> <span class="token constant">BASE_URL</span> <span class="token operator">=</span> <span class="token string">&#39;http://xxxxx/api/&#39;</span>

<span class="token keyword">class</span> <span class="token class-name">HuyRequest</span> <span class="token punctuation">{</span>
  <span class="token generic-function"><span class="token function">request</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token builtin">any</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
    url<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
    method<span class="token operator">:</span> Methods<span class="token punctuation">,</span>
    data<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span>
    options<span class="token operator">?</span><span class="token operator">:</span> UseFetchOptions<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>AsyncData<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> Error<span class="token operator">&gt;&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token builtin">Promise</span></span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// Fetch 请求 options</span>
      <span class="token keyword">const</span> newOptions<span class="token operator">:</span> UseFetchOptions<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
        baseURL<span class="token operator">:</span> <span class="token constant">BASE_URL</span><span class="token punctuation">,</span>
        method<span class="token operator">:</span> method<span class="token punctuation">,</span>
        <span class="token operator">...</span>options<span class="token punctuation">,</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span>method <span class="token operator">===</span> <span class="token string">&#39;GET&#39;</span><span class="token punctuation">)</span> newOptions<span class="token punctuation">.</span>query <span class="token operator">=</span> data
      <span class="token keyword">if</span> <span class="token punctuation">(</span>method <span class="token operator">===</span> <span class="token string">&#39;POST&#39;</span><span class="token punctuation">)</span> newOptions<span class="token punctuation">.</span>body <span class="token operator">=</span> data

      <span class="token comment">// 实际请求</span>
      <span class="token generic-function"><span class="token function">useFetch</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> newOptions<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span>res <span class="token keyword">as</span> AsyncData<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> Error<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token generic-function"><span class="token function">get</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token builtin">any</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>url<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> params<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> options<span class="token operator">?</span><span class="token operator">:</span> UseFetchOptions<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token string">&#39;GET&#39;</span><span class="token punctuation">,</span> params<span class="token punctuation">,</span> options<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token generic-function"><span class="token function">post</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token builtin">any</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>url<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> data<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> options<span class="token operator">?</span><span class="token operator">:</span> UseFetchOptions<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token string">&#39;POST&#39;</span><span class="token punctuation">,</span> data<span class="token punctuation">,</span> options<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul>`,10);function Z(K,Q){const a=v("ExternalLinkIcon");return m(),g("div",null,[b,n("table",null,[y,n("tbody",null,[f,h,x,_,w,j,q,A,S,T,n("tr",null,[C,N,R,n("td",O,[s("关于 "),n("a",U,[s("Suspense"),t(a)]),s(" resolved 事件。")])]),F,n("tr",null,[L,E,V,n("td",P,[s("在"),n("a",D,[s("Suspense"),t(a)]),s(" 等待事件中调用。")])]),n("tr",null,[B,M,H,n("td",z,[s("调用 "),n("a",G,[s("Suspense"),t(a)]),s(" resolved 事件。")])]),n("tr",null,[I,$,J,n("td",W,[s("页面转换 "),n("a",X,[s("onAfterLeave"),t(a)]),s(" 事件.")])])])]),Y])}const sn=p(k,[["render",Z],["__file","ssr03.html.vue"]]);export{sn as default};
