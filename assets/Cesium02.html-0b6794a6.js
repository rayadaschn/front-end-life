import{_ as e,Z as o,a0 as i,F as c,a1 as l,X as u,Y as r,$ as d}from"./framework-5dd7fabc.js";const k={},n=o,s=i,m=c,t=l,p=d,v=u,g=r,b=p('<h2 id="背景介绍" tabindex="-1"><a class="header-anchor" href="#背景介绍" aria-hidden="true">#</a> 背景介绍</h2><p>Cesium 是一个跨平台、跨浏览器的展示三维地球和地图的开源 Javascript 库。Cesium 不需要任何插件支持，但是浏览器必须支持 WebGL 才能运行 Cesium。</p><p>主要功能：</p><ol><li>使用 3D Tile 格式可加载大规模的多样化三维数据，如倾斜摄影数据、三维建筑物模型、CAD 软件文件等。</li><li>支持全球级别高精度三维地形和图层服务，包含地形（terrain）、网络地图瓦片服务（WMTS）、瓦片地图服务（TMS）及网络地图服务（WMS）等图层服务。</li><li>定义 CZML 数据格式，支持大场景时序动态数据的三维可视化，并具备粒子系统，能够模拟各种自然或人为事件，如雨雪天气等。</li></ol><h3 id="开发环境" tabindex="-1"><a class="header-anchor" href="#开发环境" aria-hidden="true">#</a> 开发环境</h3><p>这是第一个大坑，这对于前端工程化还是有一定的要求的。若是不愿意折腾可以直接用笔者的配置。</p><p>环境：<code>node v20.9.0</code> 框架: <code>Vue3</code> + <code>TS</code> + <code>Vite</code></p>',7),h={href:"https://github.com/rayadaschn/learning_cesium/tree/dev",target:"_blank",rel:"noopener noreferrer"},y=n("h3",{id:"为什么开发环境如此复杂",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#为什么开发环境如此复杂","aria-hidden":"true"},"#"),s(" 为什么开发环境如此复杂?")],-1),C={href:"https://cesium.com/downloads",target:"_blank",rel:"noopener noreferrer"},_=p(`<figure><img src="https://cdn.jsdelivr.net/gh/rayadaschn/blogImage@master/img/202405292255896.png" alt="Cesium" tabindex="0" loading="lazy"><figcaption>Cesium</figcaption></figure><p>Cesium 的开发包解压后主要的文件夹如下:</p><ol><li>Apps 文件夹: 包含一个最简单的 HelloWorld 官方实例。</li><li>Build 文件夹: 包含 Cesium 的开发资源包及其相关依赖文件的集合，是<strong>最主要的开发文件包</strong>。</li><li>packages 文件夹: 包含的 engine 和 widgets 两个子文件夹，主要是为了模块化使用，其中 engine 这个文件夹通常包含 Cesium 的核心引擎代码，它是构建整个 Cesium 应用程序的基础。它提供了渲染 3D 场景、处理用户交互、加载和显示地形数据、管理地图图层、处理空间查询等功能。widgets 文件夹包含的是 Cesium 提供的一组可重用的 UI 组件，这些组件可以被集成到 Cesium 应用程序中，以提供常见的功能，如地图控件（缩放、平移、旋转）、图层管理器、地理信息标注等。</li><li>Source 文件夹: 包含 Cesium 自带应用程序代码和数据。</li><li>Specs 文件夹: 包含 Cesium 单元测试代码。</li><li>ThirdParty 文件夹: 包含 Cesium 依赖的第三方库。</li><li>其它配置文件等。</li></ol><p>虽然这样解释了一下它的主要结构，但可能还是不够直观。</p><p>由于 Cesium 是纯 js 代码，所以不能直接运行 <code>index.html</code> 文件，它需要跑在服务器上，官方推荐的是 node 方法，即用 node 开启一个静态服务器进行挂载。而我们的目的不仅仅是跑官方示例，而是系统开发。所以，需要再深入一点。</p><p>以工程化的 vue 项目为例，我们正常开发一个项目，需要安装 node 相关依赖，然后再运行 node 服务，最后才能跑 vue 项目。</p><p>但是 Cesium 给我们的包并不是纯粹的 js 包。还有一些它自身的依赖，而我们所需要的资源可能只是其中的一部分。在开发阶段可以将所有资源放在开发环境本地，但是在生产环境中大可不必如此。因此，需要区分环境，以作开发和生产的区分。下面我们来看一下官网的一个基本使用教程。</p><p>在官网的教程中，我们是这样用 cesium 的：</p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- Use correct character set. --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>utf-8<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!-- Tell IE to use the latest, best version. --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>X-UA-Compatible<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>IE=edge<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!-- Make the application on mobile take up the full browser screen and disable user scaling. --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span>
      <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no<span class="token punctuation">&quot;</span></span>
    <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Hello World!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>../Build/Cesium/Cesium.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
      <span class="token atrule"><span class="token rule">@import</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>../Build/Cesium/Widgets/widgets.css<span class="token punctuation">)</span></span><span class="token punctuation">;</span></span>
      <span class="token selector">html,
      body,
      #cesiumContainer</span> <span class="token punctuation">{</span>
        <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
        <span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
        <span class="token property">margin</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
        <span class="token property">padding</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
        <span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cesiumContainer<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
      <span class="token keyword">var</span> viewer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>Viewer</span><span class="token punctuation">(</span><span class="token string">&#39;cesiumContainer&#39;</span><span class="token punctuation">)</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>它实际上进行了这几步操作:</p><ol><li><p>引入 <code>Cesium.js</code> 核心库。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;../Build/Cesium/Cesium.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>导入 Cesium Viewer widget 的样式，使得 Cesium Viewer 能够正确显示。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>@<span class="token keyword">import</span> <span class="token function">url</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>Build<span class="token operator">/</span>Cesium<span class="token operator">/</span>Widgets<span class="token operator">/</span>widgets<span class="token punctuation">.</span>css<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>创建一个 Cesium Viewer 实例，并将其挂载到 id 为 cesiumContainer 的 div 上。这个就是我们实际的网页视口元素了。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">var</span> viewer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>Viewer</span><span class="token punctuation">(</span><span class="token string">&#39;cesiumContainer&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ol><p>可以看到我们引入的资源都在 <code>Build</code> 文件夹底下,也就是含 Cesium 的开发资源包及其相关依赖文件的集合。在开发环境中，我们直接使用这些资源包，而生产环境中，我们则需要将这些资源包进行打包，然后将打包后的资源包放置在服务器上，再通过服务器来提供服务。因此在构建项目时需要格外进行一些配置操作。</p><p>当然为了打包速度更快（白嫖官方的 CND），在生产环境中，笔者用 cesium 的本地包，而在开发环境中使用 cnd 加载 cesium 的包。这样的好处在于速度更快，若是要在局域网内使用，则可以考虑使用 nginx 进行代理。将 cesium 的包放置于服务器的指定位置。</p>`,13),f={class:"hint-container tip"},w=n("p",{class:"hint-container-title"},"提示",-1),S={href:"https://github.com/nshen/vite-plugin-cesium",target:"_blank",rel:"noopener noreferrer"},q=n("code",null,"vite-plugin-cesium",-1),E=p(`<h3 id="配置-vite-环境" tabindex="-1"><a class="header-anchor" href="#配置-vite-环境" aria-hidden="true">#</a> 配置 vite 环境</h3><p>在 vite.config.ts 中，需要对 cesium 进行配置，以区分开发环境和生产环境。首先区分 Base URL，即 cesium 的包路径。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 开发模式为: 拷贝后的打包路径</span>
VITE_CESIUM_BASE_URL <span class="token operator">=</span> libs/cesium/

<span class="token comment"># 生成环境为：cesium 的 cdn 地址，亦可换成指定的下载地址。</span>
<span class="token comment"># 注意：需要将 cesium 替换为你的 cesium 版本号，以及末尾用 / 结尾。</span>
VITE_CESIUM_BASE_URL <span class="token operator">=</span> https://www.unpkg.com/cesium@1.115.0/Build/Cesium/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,3),x=n("code",null,"lib/cesium",-1),B={href:"https://github.com/sapphi-red/vite-plugin-static-copy",target:"_blank",rel:"noopener noreferrer"},j=n("code",null,"viteStaticCopy",-1),U=n("code",null,"lib/cesium",-1),L=p(`<figure><img src="https://cdn.jsdelivr.net/gh/rayadaschn/blogImage@master/img/202405292353038.png" alt="拷贝后的打包路径" tabindex="0" loading="lazy"><figcaption>拷贝后的打包路径</figcaption></figure><p>再次说明，这里是为了统一开发和生产环境，所以需要将 <code>libs/cesium</code> 目录下的文件拷贝到 <code>lib/cesium</code> 目录下。以下是 vite.config.ts 中的相关配置。</p><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token comment">// 开发模式，复制 node_modules 下的 cesium 依赖</span>
<span class="token keyword">const</span> cesiumLibraryRoot <span class="token operator">=</span> <span class="token string">&#39;node_modules/cesium/Build/CesiumUnminified/&#39;</span>
<span class="token keyword">const</span> cesiumLibraryCopyToRootPath <span class="token operator">=</span> <span class="token string">&#39;libs/cesium/&#39;</span> <span class="token comment">// 相对于打包后的路径</span>
<span class="token comment">// 拷贝地址选项</span>
<span class="token keyword">const</span> cesiumStaticSourceCopyOptions <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token string">&#39;Assets&#39;</span><span class="token punctuation">,</span>
  <span class="token string">&#39;ThirdParty&#39;</span><span class="token punctuation">,</span>
  <span class="token string">&#39;Workers&#39;</span><span class="token punctuation">,</span>
  <span class="token string">&#39;Widgets&#39;</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>dirName<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    src<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>cesiumLibraryRoot<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>dirName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/*</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span> <span class="token comment">// 注意后面的 * 字符，文件夹全量复制</span>
    dest<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>cesiumLibraryCopyToRootPath<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>dirName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// vite 插件</span>
plugins<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>
  <span class="token comment">/** viteStaticCopy: https://github.com/sapphi-red/vite-plugin-static-copy */</span>
  <span class="token function">viteStaticCopy</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    targets<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token comment">// 主库文件，开发时选用非压缩版的 IIFE 格式主库文件</span>
      <span class="token punctuation">{</span>
        src<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>cesiumLibraryRoot<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">Cesium.js</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span>
        dest<span class="token operator">:</span> cesiumLibraryCopyToRootPath<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token comment">// 四大静态文件夹</span>
      <span class="token operator">...</span>cesiumStaticSourceCopyOptions<span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>统一了静态资源后，还需要引入 cesium 的 js 包。这里用到 <code>insertHtml</code> 插件，作用是在 html 中插入想要的内容。</p><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">const</span> cesiumBaseUrl <span class="token operator">=</span> env<span class="token punctuation">[</span><span class="token string">&quot;VITE_CESIUM_BASE_URL&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 环境变量 cesium 地址</span>
<span class="token keyword">const</span> base <span class="token operator">=</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 默认路径</span>

<span class="token function">insertHtml</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  head<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// 生产模式使用 CDN 或已部署的 CesiumJS 在线库链接，开发模式用拷贝的库文件，根据 VITE_CESIUM_BASE_URL 自动拼接</span>
    <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">&quot;script&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token comment">// 因为涉及前端路径访问，所以开发模式最好显式拼接 base 路径，适配不同 base 路径的情况</span>
      src<span class="token operator">:</span> isProd
        <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>cesiumBaseUrl<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">Cesium.js</span><span class="token template-punctuation string">\`</span></span>
        <span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>base<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>cesiumBaseUrl<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">Cesium.js</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>最后一步，将 cesium 挂在在 window 的全局，以便生成环境和开发环境都能访问到。这里用到插件 <code>viteExternalsPlugin</code>。</p><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token function">viteExternalsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  cesium<span class="token operator">:</span> <span class="token string">&quot;Cesium&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 外部化 cesium 依赖，之后全局访问形式是 window[&#39;Cesium&#39;]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,7),I={href:"https://github.com/rayadaschn/learning_cesium/tree/dev",target:"_blank",rel:"noopener noreferrer"},T=p(`<div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>
  defineConfig<span class="token punctuation">,</span>
  <span class="token keyword">type</span> <span class="token class-name">PluginOption</span><span class="token punctuation">,</span>
  splitVendorChunkPlugin<span class="token punctuation">,</span>
  loadEnv<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vite&#39;</span>
<span class="token keyword">import</span> vue <span class="token keyword">from</span> <span class="token string">&#39;@vitejs/plugin-vue&#39;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> viteExternalsPlugin <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vite-plugin-externals&#39;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> insertHtml<span class="token punctuation">,</span> h <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vite-plugin-insert-html&#39;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> viteStaticCopy <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vite-plugin-static-copy&#39;</span>
<span class="token keyword">import</span> compress <span class="token keyword">from</span> <span class="token string">&#39;vite-plugin-compression&#39;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> envDir<span class="token punctuation">,</span> sourceDir<span class="token punctuation">,</span> manualChunks <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./scripts/build&#39;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span> mode <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> env <span class="token operator">=</span> <span class="token function">loadEnv</span><span class="token punctuation">(</span>mode<span class="token punctuation">,</span> envDir<span class="token punctuation">)</span>
  <span class="token keyword">const</span> isProd <span class="token operator">=</span> mode <span class="token operator">===</span> <span class="token string">&#39;production&#39;</span>

  <span class="token keyword">const</span> cesiumBaseUrl <span class="token operator">=</span> env<span class="token punctuation">[</span><span class="token string">&#39;VITE_CESIUM_BASE_URL&#39;</span><span class="token punctuation">]</span>

  <span class="token keyword">const</span> base <span class="token operator">=</span> <span class="token string">&#39;/&#39;</span> <span class="token comment">// 默认路径</span>

  <span class="token keyword">const</span> plugins<span class="token operator">:</span> PluginOption<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token function">vue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">splitVendorChunkPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">viteExternalsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      cesium<span class="token operator">:</span> <span class="token string">&#39;Cesium&#39;</span><span class="token punctuation">,</span> <span class="token comment">// 外部化 cesium 依赖，之后全局访问形式是 window[&#39;Cesium&#39;]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">insertHtml</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      head<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token comment">// 生产模式使用 CDN 或已部署的 CesiumJS 在线库链接，开发模式用拷贝的库文件，根据 VITE_CESIUM_BASE_URL 自动拼接</span>
        <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">&#39;script&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
          <span class="token comment">// 因为涉及前端路径访问，所以开发模式最好显式拼接 base 路径，适配不同 base 路径的情况</span>
          src<span class="token operator">:</span> isProd
            <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>cesiumBaseUrl<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">Cesium.js</span><span class="token template-punctuation string">\`</span></span>
            <span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>base<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>cesiumBaseUrl<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">Cesium.js</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isProd<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 开发模式，复制 node_modules 下的 cesium 依赖</span>
    <span class="token keyword">const</span> cesiumLibraryRoot <span class="token operator">=</span> <span class="token string">&#39;node_modules/cesium/Build/CesiumUnminified/&#39;</span>
    <span class="token keyword">const</span> cesiumLibraryCopyToRootPath <span class="token operator">=</span> <span class="token string">&#39;libs/cesium/&#39;</span> <span class="token comment">// 相对于打包后的路径</span>
    <span class="token keyword">const</span> cesiumStaticSourceCopyOptions <span class="token operator">=</span> <span class="token punctuation">[</span>
      <span class="token string">&#39;Assets&#39;</span><span class="token punctuation">,</span>
      <span class="token string">&#39;ThirdParty&#39;</span><span class="token punctuation">,</span>
      <span class="token string">&#39;Workers&#39;</span><span class="token punctuation">,</span>
      <span class="token string">&#39;Widgets&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>dirName<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        src<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>cesiumLibraryRoot<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>dirName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/*</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span> <span class="token comment">// 注意后面的 * 字符，文件夹全量复制</span>
        dest<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>cesiumLibraryCopyToRootPath<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>dirName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    plugins<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>
      <span class="token comment">/** viteStaticCopy: https://github.com/sapphi-red/vite-plugin-static-copy */</span>
      <span class="token function">viteStaticCopy</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        targets<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token comment">// 主库文件，开发时选用非压缩版的 IIFE 格式主库文件</span>
          <span class="token punctuation">{</span>
            src<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>cesiumLibraryRoot<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">Cesium.js</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span>
            dest<span class="token operator">:</span> cesiumLibraryCopyToRootPath<span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token comment">// 四大静态文件夹</span>
          <span class="token operator">...</span>cesiumStaticSourceCopyOptions<span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  plugins<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>
    <span class="token function">compress</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      threshold<span class="token operator">:</span> <span class="token number">10</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">,</span> <span class="token comment">// 10KB 以下不压缩</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    base<span class="token punctuation">,</span>
    envDir<span class="token punctuation">,</span>
    mode<span class="token punctuation">,</span>
    plugins<span class="token punctuation">,</span>
    resolve<span class="token operator">:</span> <span class="token punctuation">{</span>
      alias<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">&#39;@&#39;</span><span class="token operator">:</span> sourceDir<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,1);function V(P,R){const a=m("ExternalLinkIcon");return v(),g("div",null,[b,n("p",null,[s("Github 代码: "),n("a",h,[s("传送门 🚪"),t(a)])]),y,n("p",null,[s("以"),n("a",C,[s("官网"),t(a)]),s("的下载为例。")]),_,n("div",f,[w,n("p",null,[s("当然可以使用 vite 的插件 "),n("a",S,[q,t(a)]),s(" 来进行 cesium 的打包，但是由于 cesium 官方的包体积较大，因此在学习过程中不推荐使用。")])]),E,n("p",null,[s("这里你可能会疑惑，为什么开发环境的 Base URL 是 "),x,s("，这里是借助了 vite 插件 "),n("a",B,[j,t(a)]),s("，会将 我们所需要的 cesium 的相关包拷贝到浏览器的 "),U,s(" 目录下。")]),L,n("p",null,[s("下面是完整的 vite 配置代码，当然有些细节可以参考 Github 代码: "),n("a",I,[s("传送门 🚪"),t(a)]),s(":")]),T])}const $=e(k,[["render",V],["__file","Cesium02.html.vue"]]);export{$ as default};
