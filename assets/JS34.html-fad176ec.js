import{_ as n,X as s,Y as a,$ as p}from"./framework-5dd7fabc.js";const t={},e=p,o=s,c=a,l=e(`<p>ä¸€ç›´ä»¥æ¥ï¼Œå¯¹ Promise çš„çŠ¶æ€å¸æ”¶é—®é¢˜ï¼Œæˆ‘éƒ½æ²¡æœ‰å¾ˆå¥½ç†è§£ï¼Œä»Šå¤©ç»ˆäºç†é¡ºäº†ï¼Œå› æ­¤è®°å½•ä¸€ä¸‹ã€‚</p><blockquote><p>ç”±äº Promise è§„èŒƒä¸­å¯¹è¿™å—æ²¡æœ‰è¯¦ç»†å®šä¹‰ï¼Œå› æ­¤è¿™é‡Œçš„ Promise å¤„ç†æœºåˆ¶å‡æ˜¯åŸºäº V8 å¼•æ“çš„ã€‚</p></blockquote><h2 id="promise-å›é¡¾" tabindex="-1"><a class="header-anchor" href="#promise-å›é¡¾" aria-hidden="true">#</a> Promise å›é¡¾</h2><p>Promise æœ‰ä¸‰ç§çŠ¶æ€ï¼š<code>pending</code>ã€<code>fulfilled</code>ã€<code>rejected</code>ã€‚å½“ä½¿ç”¨ <code>resolve</code> æˆ– <code>reject</code> æ—¶ï¼ŒPromise çš„çŠ¶æ€ä¼šå‘ç”Ÿå˜åŒ–ï¼Œä½†ä¸€æ—¦çŠ¶æ€å‘ç”Ÿå˜åŒ–ï¼Œå°±ä¸ä¼šå†å˜ã€‚</p><p>è€Œ Promise çš„å¸æ”¶æ˜¯æŒ‡å½“ resolve ä¸€ä¸ª Promise æ—¶ï¼Œä¼šå¸æ”¶è¯¥ Promise çš„çŠ¶æ€ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°çš„ Promiseã€‚ä¾‹å¦‚åœ¨é“¾å¼è°ƒç”¨ä¸­ï¼Œä¸€ä¸ª Promise çš„è§£å†³å€¼å¯èƒ½æ˜¯å¦ä¸€ä¸ª Promiseï¼Œæ­¤æ—¶å¤–å±‚çš„ Promise ä¼šç­‰å¾…å†…éƒ¨ Promise çš„çŠ¶æ€å˜åŒ–ï¼Œä»è€ŒåŒæ­¥è‡ªå·±çš„çŠ¶æ€ã€‚è¿™é€šå¸¸è¢«ç§°ä¸ºâ€œPromise çš„å¸æ”¶â€ã€‚</p><blockquote><p>å¦‚æœå¤–å±‚æ˜¯ reject ä¸€ä¸ª Promiseï¼Œåˆ™ä¼šç›´æ¥è¿”å›ä¸€ä¸ª rejected çŠ¶æ€çš„ Promiseï¼Œè€Œä¸ä¼šå¸æ”¶å†…éƒ¨ Promise çš„çŠ¶æ€ã€‚</p></blockquote><p>ä¾‹å¦‚ï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> innerPromise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>

<span class="token keyword">const</span> outerPromise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span>innerPromise<span class="token punctuation">)</span> <span class="token comment">// ä¼ å…¥ä¸€ä¸ª Promise</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

outerPromise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token comment">// 1ç§’åè¾“å‡º 42</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªæ–° Promise çš„çŠ¶æ€å°†ç”±å†…éƒ¨çš„ <code>Promise.resolve(42)</code>å†³å®šï¼Œå³æœ€ç»ˆå˜ä¸º <code>fulfilled</code>ï¼Œå€¼ä¸º <strong>42</strong>ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå¤–å±‚ Promiseâ€œå¸æ”¶â€äº†å†…éƒ¨ Promise çš„çŠ¶æ€ã€‚</p><blockquote><p><strong>é¢å¤–æ€è€ƒ</strong>ğŸ¤”: ä¸ºä»€ä¹ˆéœ€è¦çŠ¶æ€å¸æ”¶å‘¢ï¼Ÿ</p><p>å…¶å®ï¼Œåè¿‡æ¥æƒ³ï¼Œå¦‚æœç›´æ¥è®©å¤–å±‚ Promise è¿›å…¥åˆ° fulfilled çŠ¶æ€ï¼ˆå€¼ä¸ºå†…å±‚ Promise å¯¹è±¡ï¼‰ï¼Œè¿™æ ·ä¼šå¯¼è‡´ Promise çš„é“¾å¼è°ƒç”¨ï¼ˆ<code>.then()</code>ï¼‰éœ€è¦ç”¨æˆ·æ‰‹åŠ¨å¤„ç†åµŒå¥—çš„ Promiseã€‚å³ç”¨æˆ·éœ€è¦è‡ªå·±é€ è½®å­ï¼Œä»è€Œç ´åé“¾å¼è°ƒç”¨çš„ç®€æ´æ€§ã€‚</p><p>çŠ¶æ€å¸æ”¶ä½¿å¾—æˆ‘ä»¬ï¼Œæ— éœ€æ‰‹åŠ¨è§£åŒ…åµŒå¥—çš„ Promiseã€‚</p><p>å¦‚æœæ˜¯å¥—å¨ƒå¾ªç¯å¼•ç”¨å‘¢? å¦‚æœ Promise A çš„è§£å†³ä¾èµ–äº Promise Bï¼Œè€Œ Promise B çš„è§£å†³åˆä¾èµ–äº Promise Aï¼ŒV8 ä¼šæ£€æµ‹åˆ°å¾ªç¯å¼•ç”¨å¹¶æŠ›å‡º <code>TypeError</code>ã€‚</p></blockquote><h2 id="promise-çš„å¸æ”¶æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#promise-çš„å¸æ”¶æœºåˆ¶" aria-hidden="true">#</a> Promise çš„å¸æ”¶æœºåˆ¶</h2><p>èƒ½å¤Ÿç†è§£ä¸Šæ–‡ï¼Œæ¥ä¸‹æ¥å°±çœ‹ Promise é“¾ä¸­çš„çŠ¶æ€ä¼ é€’äº†ã€‚å…ˆçœ‹ä¸€ä¸ªä¾‹å­ï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;p1&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> p2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

p1<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

p2<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªå…¶å®æœ‰ç‚¹éš¾äº†ï¼Œéœ€è¦ç»“åˆä¸Šé¢çš„ Promise å¸æ”¶æœºåˆ¶æ¥ç†è§£ã€‚</p><ol><li><p>é¦–å…ˆå®šä¹‰äº†ä¿©ä¸ª Promiseï¼Œp1 å’Œ p2ï¼Œä½†æ˜¯ P2 éœ€è¦ç­‰å¾… P1 çš„çŠ¶æ€å˜åŒ–ï¼Œå› æ­¤ p2 çš„çŠ¶æ€æ˜¯ pendingã€‚</p></li><li><p>P1 é¦–å…ˆå˜åŒ–è¿›å…¥åˆ° fulfilled çŠ¶æ€ï¼Œå€¼ä¸º p1ã€‚å› æ­¤æ‰“å° <code>p1 0</code>ï¼Œç„¶å p2 å¸æ”¶ p1 çš„çŠ¶æ€ï¼Œå› æ­¤ p2 çš„çŠ¶æ€ä¹Ÿå˜æˆäº† fulfilledï¼Œå€¼ä¸º <code>p1</code>ã€‚</p></li><li><p>ç”±äº p1 å…ˆæ‰§è¡Œï¼Œå› æ­¤æ¥ä¸‹æ¥ p1 å’Œ p2 çš„é“¾å¼è°ƒç”¨ä¼šåŒæ—¶ä¾æ¬¡æ‰§è¡Œã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// ä¾æ¬¡æ‰“å°</span>
p1 <span class="token number">0</span>
<span class="token keyword">undefined</span> <span class="token number">1</span>
p1 <span class="token number">4</span>
<span class="token keyword">undefined</span> <span class="token number">2</span>
<span class="token keyword">undefined</span> <span class="token number">5</span>
<span class="token keyword">undefined</span> <span class="token number">6</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><h2 id="æ·±å…¥ç†è§£" tabindex="-1"><a class="header-anchor" href="#æ·±å…¥ç†è§£" aria-hidden="true">#</a> æ·±å…¥ç†è§£</h2><p>å¯ä»¥æ€è€ƒä¸€ä¸‹ ğŸ¤”ï¼Œå¦‚æœ p1 æ˜¯ rejected çŠ¶æ€å‘¢ï¼Ÿæˆ–è€… p2 æ˜¯ rejected çŠ¶æ€å‘¢ï¼Ÿ</p><p>åœ¨å¼€å¤´è®²åˆ°ï¼Œå¦‚æœå¤–å±‚æ˜¯ reject ä¸€ä¸ª Promiseï¼Œåˆ™ä¼šç›´æ¥è¿”å›ä¸€ä¸ª rejected çŠ¶æ€çš„ Promiseï¼Œè€Œä¸ä¼šå¸æ”¶å†…éƒ¨ Promise çš„çŠ¶æ€ã€‚å› æ­¤ï¼Œå¦‚æœ p1 æ˜¯ rejected çŠ¶æ€ï¼Œé‚£ä¹ˆ p2 çš„çŠ¶æ€ä¹Ÿä¼šæ˜¯ rejected çŠ¶æ€ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">&#39;p1&#39;</span><span class="token punctuation">)</span> <span class="token comment">// è¿™é‡Œrejectäº†</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> p2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

p1<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment">// ä¾æ¬¡åˆ°è¿™é‡Œreject --&gt; p1 3</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

p2<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span> <span class="token comment">// p2 ç»§æ‰¿äº†p1çš„reject --&gt; p1 3</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šé¢ç»“æœæ˜¯:</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>p1 <span class="token number">3</span>
p1 <span class="token number">3</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœ p2 æ˜¯ rejected çŠ¶æ€ï¼Œé‚£ä¹ˆå°±ä¸ä¼šç»§æ‰¿ p1 çš„çŠ¶æ€ï¼Œè¿˜æ˜¯ä¿æŒ rejectedã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;p1&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> p2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">reject</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span> <span class="token comment">// è¿™é‡Œrejectäº†</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

p1<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// p1 0</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// undefined 1</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">// undefined 2</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

p2<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span> <span class="token comment">// p2 ç»§æ‰¿äº†ä¸€ä¸ª fulfilled çŠ¶æ€çš„p1 --&gt; Promise { &#39;p1&#39; } 7</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒPromise çš„é“¾å¼è°ƒç”¨æ˜¯äº¤æ›¿ä¾æ¬¡è¿›è¡Œçš„ã€‚è¿™é‡Œä¸è¿‡å¤šå±•å¼€ã€‚</p><h2 id="æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“" aria-hidden="true">#</a> æ€»ç»“</h2><p><code>resolve()</code> ä¼ å…¥ Promise æ—¶ï¼Œå¿…é¡»ç­‰è¿™ä¸ª Promise æ‰§è¡Œå®Œï¼Œæ‰èƒ½å†³å®šè‡ªå·±çš„çŠ¶æ€ã€‚</p><p>ğŸ”¥ å£è¯€:</p><blockquote><p><code>resolve(Promise)</code> == çŠ¶æ€è·Ÿéš; <code>resolve(p1)</code> ä¼šç­‰å¾… p1 çš„çŠ¶æ€ç»“æœï¼Œç„¶åä¼ é€’ã€‚ <code>resolve(å€¼)</code> == ç›´æ¥æˆåŠŸ; <code>reject(Promise)</code> == ç›´æ¥æŠ›å‡ºå¯¹è±¡æœ¬èº«ã€‚<code>reject(p1)</code> åªæ˜¯ç›´æ¥æŠŠ p1 å½“æˆé”™è¯¯åŸå› ï¼Œä¸å…³å¿ƒçŠ¶æ€ã€‚</p></blockquote><h2 id="æŒ‘æˆ˜" tabindex="-1"><a class="header-anchor" href="#æŒ‘æˆ˜" aria-hidden="true">#</a> æŒ‘æˆ˜</h2><p>å¦‚æœå¯¹ä¸Šæ–‡ç†è§£æ¸…æ¥šäº†ï¼Œå¯ä»¥è¯•è¯•ä¸‹é¢ ğŸ‘‡ğŸ» è¿™é“é¢˜ï¼Œçœ‹çœ‹èƒ½ä¸èƒ½ä¸€æ¬¡æ€§åšå¯¹ã€‚æœ‰ç‚¹éš¾åº¦ ğŸ¤¯</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">p1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token keyword">await</span> <span class="token function">p2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">p2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">p1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ğŸ¯ å…¶ç»“æœæ˜¯:</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token number">1</span>
<span class="token number">3</span>
<span class="token number">5</span>
<span class="token number">7</span> <span class="token number">8</span>
<span class="token number">6</span>
<span class="token keyword">undefined</span> <span class="token number">9</span>
<span class="token number">2</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è§£æ:</p><ol><li>é¦–å…ˆæ‰§è¡Œ p1ï¼Œæ‰“å° <code>1</code>ï¼Œç„¶åæ‰§è¡Œ p2ï¼Œæ‰“å° <code>3</code>ï¼Œç„¶å p2 è¿”å›ä¸€ä¸ª Promiseï¼Œp1 ç­‰å¾…è¿™ä¸ª Promiseï¼Œå› æ­¤ä¼šè¿›å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—ã€‚</li><li>åé¢ä¿©ä¸ª Promise.resolve() ä¼šä¾æ¬¡è¿›å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—, ä¾æ¬¡æ‰“å° <code>5</code> å’Œ <code>7 8</code>ã€‚æ­¤æ—¶ p2 çŠ¶æ€å®Œæˆï¼Œp1 çš„ await å¸æ”¶ p2 çš„ç»“æœï¼Œä½†è¿˜éœ€è¦è¿›å…¥å¾®ä»»åŠ¡ç­‰å¾…ä¸€æ¬¡ã€‚</li><li>æœ€åä¿©ä¸ª Promise.resolve() ä¼šä¾æ¬¡è¿›å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—, ä¾æ¬¡æ‰“å° <code>6</code> å’Œ <code>undefined 9</code>ã€‚æ­¤æ—¶ p1 çš„ await çŠ¶æ€å®Œæˆï¼Œæ‰“å° <code>2</code>ã€‚</li></ol><p>æ•´ä½“ç»“æœä¼šæœ‰ç‚¹ç»•ï¼Œä½†ç†è§£äº†ä¼šå¾ˆæ¸…æ™°ã€‚</p>`,36),u=[l];function i(k,r){return o(),c("div",null,u)}const v=n(t,[["render",i],["__file","JS34.html.vue"]]);export{v as default};
