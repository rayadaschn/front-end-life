---
title: GSLS 语法速通
icon: any
date: 2024-01-13
category:
  - 框架
tag:
  - three.js
---

GLSL 是为图形计算量身定制的用于编写着色器的语言，它包含一些针对向量和矩阵操作的特性，使渲染管线具有可编程性。

## vscode 插件

在 vscode 中需要安装插件 [Shader languages support for VS Code](https://marketplace.visualstudio.com/items?itemName=slevesque.shader) 才可以获得较好的语法提示。

## 变量语法

> Vector 表示向量

| 变量类型                      | 说明                         | 默认值                                           | 可选项                               |
| ----------------------------- | ---------------------------- | ------------------------------------------------ | ------------------------------------ |
| `bool`                        | 布尔型标量数据类型           | false                                            | 无                                   |
| `int`/`ivec2`/`ivec3`/`ivec4` | 包含 1/2/3/4 个整型向量      | 0/[0, 0]/[0, 0, 0]/[0, 0, 0, 0]                  | 无                                   |
| `float`/`vec2`/`vec3`/`vec4`  | 包含 1，2，3，4 个浮点型向量 | 0/[0, 0]/[0, 0, 0]/[0, 0, 0, 0]                  | 无                                   |
| `sampler2D `                  | 表示 2D 纹理                 | default                                          | black、grey、white、normal、default  |
| `samplerCube`                 | 表示立方体纹理               | default-cube                                     | black-cube、white-cube、default-cube |
| `mat[2..3] `                  | 表示 2x2 和 3x3 的矩阵       | 不可用                                           | 无                                   |
| `mat4  `                      | 表示 4x4 的矩阵              | [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1] | 无                                   |

## 数组

数组的用法和 C 语言类似，规则如下：

- 数组必须声明长度
- 数组不能在声明的同时初始化
- 数组必须由常量表达式初始化
- 数组不能用 const 修饰
- 不支持多维数组

数组声明和初始化的代码示例如下：

```glsl
float array[4];

for(int i =0; i < 4; i ++)
{
    array[i] = 0.0;
}
```

## 函数语法

GLSL 的函数由 **返回值**、**函数名** 和 **参数** 构成，其中返回值和函数名是必须的。若无返回值，需要使用 void 代替。

> 注意：GLSL 的函数不能递归。

```glsl
void scaleMatrix (inout mat4 m, float s){
  m[0].xyz *= s;
  m[1].xyz *= s;
  m[2].xyz *= s;
}
```

## 限定符

存储限定符用于描述变量在管线中的作用。

| 限定符    | 说明                                                                                                   |
| --------- | ------------------------------------------------------------------------------------------------------ |
| const     | 编译时为常量或作为参数时只读                                                                           |
| attribute | **应用程序**和**顶点着色器**间通信，用于确定顶点格式                                                   |
| varying   | **顶点着色器**传输给**片元着色器**的插值                                                               |
| uniform   | **应用程序** 和 **着色器**(包含定点着色器和片元着色器)之间交互数据。在顶点着色器和片元着色器中保持一致 |

> 注意: 在一个渲染过程内声明的 uniform **不能重复**。例如在顶点着色器中定义了变量 variableA，variableA 也会存在于片元着色器且值相同，那么也就是 variableA 不能在片元着色器中再次定义。

## 精度

| 限定符  | 说明                                                               |
| ------- | ------------------------------------------------------------------ |
| highp   | 高精度。浮点型精度范围 [-2^62, 2^62]，整型精度范围 [-2^16, 2^16]。 |
| mediump | 中精度。浮点型精度范围 [-2^14, 2^14]，整型精度范围 [-2^10, 2^10]。 |
| lowp    | 低精度。浮点型精度范围 [-2^8, 2^8]，整型精度范围 [-2^8, 2^8]。     |

```glsl
highp mat4 cc_matWorld;
mediump vec2 dir;
lowp vec4 cc_shadowColor;
```

## 参考文章

- [《GLSL 语法简介》](https://docs.cocos.com/creator/manual/zh/shader/glsl.html)
