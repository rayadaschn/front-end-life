---
title: standard-version è‡ªåŠ¨æ‰“ git tag
icon: linux
date: 2023-07-08
category:
  - linux
tag:
  - linux
sticky: false
---

standard-version æ˜¯ä¸€ä¸ªåŸºäº Conventional Commits è§„èŒƒçš„ç‰ˆæœ¬è‡ªåŠ¨åŒ–ç®¡ç†å·¥å…·ã€‚å®ƒå¯ä»¥è‡ªåŠ¨åŒ–åœ°ç”Ÿæˆ changelogã€æ›´æ–°ç‰ˆæœ¬å·å’Œç”Ÿæˆ git æ ‡ç­¾ç­‰æ“ä½œï¼Œä½¿å¾—ç‰ˆæœ¬ç®¡ç†å’Œå‘å¸ƒæµç¨‹æ›´åŠ è§„èŒƒåŒ–å’Œè‡ªåŠ¨åŒ–ã€‚

Conventional Commit è§„èŒƒåœ¨[ã€ŠGit æ“ä½œæ‰‹å†Œã€‹](GitOperationManuals) ä¸€æ–‡ä¸­ä»‹ç»è¿‡ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚æœ¬æ–‡ä»‹ç»ä¸€ä¸‹ standard-version è¿™ä¸ªå·¥å…·æ˜¯å¦‚ä½•é€šè¿‡ package.json æ›´æ–° CHANGELOG çš„ã€‚

[å®˜æ–¹æ–‡æ¡£ä¼ é€é—¨ ğŸšª](https://github.com/conventional-changelog/standard-version#bumpfiles-packagefiles-and-updaters)

## åŸºæœ¬çš„ Git å‘ç‰ˆè¿‡ç¨‹

ä¸€ä¸ªåŸºæœ¬çš„ Git ç‰ˆæœ¬å‘å¸ƒæµç¨‹ï¼ŒåŒ…æ‹¬ä»¥ä¸‹å…·ä½“æ­¥éª¤ï¼š

- `git pull origin master`ï¼šä»è¿œç¨‹ä»“åº“çš„ master åˆ†æ”¯æ‹‰å–æœ€æ–°ä»£ç ã€‚è¿™æ˜¯ä¸ºäº†ç¡®ä¿æœ¬åœ°ä»£ç ä¸è¿œç¨‹ä»£ç ä¿æŒåŒæ­¥ï¼Œé¿å…ç‰ˆæœ¬å†²çªã€‚
- æ ¹æ® package.json ä¸­çš„ version æ›´æ–°ç‰ˆæœ¬å·å’Œ changelogã€‚é€šå¸¸å¯ä»¥ä½¿ç”¨è‡ªåŠ¨åŒ–å·¥å…·ï¼Œå¦‚ standard-version æˆ– npm version ç­‰ï¼Œæ¥è‡ªåŠ¨ç”Ÿæˆç‰ˆæœ¬å·å’Œ changelogï¼Œä»¥æé«˜ç‰ˆæœ¬ç®¡ç†çš„è§„èŒƒæ€§å’Œæ•ˆç‡ã€‚
- `git add -A`ï¼šå°†æ‰€æœ‰å˜æ›´çš„æ–‡ä»¶æ·»åŠ åˆ° Git æš‚å­˜åŒºã€‚
- `git commit`ï¼šæäº¤æ”¹åŠ¨åˆ°æœ¬åœ° Git ä»“åº“ï¼Œå¹¶æ·»åŠ æäº¤ä¿¡æ¯ã€‚æäº¤ä¿¡æ¯åº”å½“æ¸…æ™°ã€ç®€æ´ã€æ˜ç¡®ï¼Œä»¥ä¾¿å…¶ä»–å¼€å‘äººå‘˜ç†è§£æ”¹åŠ¨çš„å†…å®¹ã€‚
- `git tag`ï¼šæ‰“ä¸Šç‰ˆæœ¬å·æ ‡ç­¾ï¼Œå¹¶å°†æ ‡ç­¾æ¨é€åˆ°è¿œç¨‹ä»“åº“ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ `git tag v1.0.0` å‘½ä»¤æ‰“ä¸Šç‰ˆæœ¬å·ä¸º 1.0.0 çš„æ ‡ç­¾ã€‚æ ‡ç­¾å¯ä»¥æ–¹ä¾¿åœ°æ ‡è®°ç‰ˆæœ¬å’Œå‘å¸ƒä¿¡æ¯ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥ç”¨äº Git å›é€€å’Œæ¯”è¾ƒç­‰æ“ä½œã€‚
- `git push`ï¼šå°†æœ¬åœ°ä»£ç å’Œæ ‡ç­¾æ¨é€åˆ°è¿œç¨‹ä»“åº“ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ `git push origin master --tags` å‘½ä»¤å°†æœ¬åœ° master åˆ†æ”¯å’Œæ‰€æœ‰æ ‡ç­¾æ¨é€åˆ°è¿œç¨‹ä»“åº“ã€‚

ä¸Šè¿°è¿‡ç¨‹ä¸­ç»å¤§éƒ¨åˆ†å¯ä»¥é€šè¿‡ standard-version æ¥è‡ªåŠ¨åŒ–å®Œæˆï¼Œä»¥å‡å°‘æ„å¤–çš„äº§ç”Ÿã€‚

standard-version æ‰€åšçš„äº‹æƒ…å®é™…ä¸Šå°± 3 ç‚¹: è‡ªåŠ¨åŒ–å‡çº§ `package.json` ä¸­çš„ç‰ˆæœ¬å·ã€æ›´æ–°/ç”Ÿæˆ `CHANGELOG.md` å’Œ tag ç‰ˆæœ¬ã€‚ä¸‹é¢çœ‹ä¸€ä¸‹å…·ä½“å¦‚ä½•ä½¿ç”¨ã€‚

## å®‰è£…å’Œé…ç½®

åœ¨é¡¹ç›®ä¸­å®‰è£…ï¼š

```bash
$: npm install -D standard-version
```

æˆ–å…¨å±€å®‰è£…ï¼š

```bash
$: npm install -g standard-version
```

å®‰è£…å®Œåï¼Œåœ¨é¡¹ç›®çš„ package.json ä¸­æ·»åŠ è„šæœ¬å‘½ä»¤:

```json
// package.json
"scripts": {
    // other...
    "release": "standard-version"
}
```

## ä½¿ç”¨

åœ¨é¡¹ç›®ç›®å½•ä¸‹ä½¿ç”¨ï¼Œä»¥æ›´æ–° CHANGELOG å’Œç‰ˆæœ¬å·ï¼š

```bash
# æ–¹æ³• 1:  å±€éƒ¨å®‰è£…ä½¿ç”¨æ–¹æ³•
$: npx standard-version
# æ–¹æ³• 2:  å±€éƒ¨å®‰è£…ä½¿ç”¨åˆšåˆšæ·»åŠ çš„è„šæœ¬å‘½ä»¤
$: npm run release

# æ–¹æ³• 3:  è‹¥å…¨å±€å®‰è£…åˆ™ç›´æ¥ä½¿ç”¨
$: standard-version
```

è¿è¡Œä¸Šé¢çš„å‘½ä»¤åï¼Œstandard-version å·¥å…·ä¼šè‡ªåŠ¨æ ¹æ® Conventional Commits è§„èŒƒç”Ÿæˆæ–°çš„ç‰ˆæœ¬å·å’Œ changelogï¼Œå¹¶æ›´æ–° package.json å’Œ CHANGELOG.md æ–‡ä»¶ã€‚åŒæ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨æ‰“ä¸Š git æ ‡ç­¾ï¼Œå¹¶ç­‰å¾… git push æ¨é€åˆ°è¿œç¨‹ä»“åº“ã€‚

## å®šåˆ¶ä½¿ç”¨

å®šåˆ¶ standard-versionï¼šstandard-version å·¥å…·æ”¯æŒå®šåˆ¶åŒ–é…ç½®ï¼Œä»¥æ»¡è¶³ä¸åŒé¡¹ç›®çš„éœ€æ±‚ã€‚å…·ä½“æ¥è¯´ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è¿›è¡Œå®šåˆ¶åŒ–é…ç½®ï¼š

- `--first-release`ï¼šç¼©å†™ `-f`ï¼ŒæŒ‡å®šæ˜¯å¦ä¸ºç¬¬ä¸€ä¸ªç‰ˆæœ¬å‘å¸ƒï¼Œå¦‚æœæ˜¯ï¼Œåˆ™ä¸å‡çº§ç‰ˆæœ¬å·ï¼Œå¹¶ä¼šè‡ªåŠ¨å°†ç‰ˆæœ¬å·è®¾ç½®ä¸º 1.0.0ã€‚
- `--release-as <version>`ï¼šç¼©å†™ `-r <version>`ï¼Œæ‰‹åŠ¨æŒ‡å®šè¦å‘å¸ƒçš„ç‰ˆæœ¬å·ã€‚

  ```bash
  $: standard-version -r minor
  # output tag: v1.1.0

  $: standard-version -r 1.0.0
  # output tag: v1.0.0

  $: standard-version -r 1.0.1-test
  # output tag: v1.0.1-test
  ```

- `--tag-prefix [prefix]`ï¼šç¼©å†™ `-t [prefix]`ï¼ŒæŒ‡å®š git æ ‡ç­¾çš„å‰ç¼€ï¼Œé»˜è®¤ä¸º `v`ã€‚

  ```bash
  $: standard-version -t 'stable-'
  # output tag: stable-1.0.1
  ```

- `--prerelease [suffix]`ï¼šç¼©å†™ `-p [prefix]`ï¼ŒæŒ‡å®š git æ ‡ç­¾çš„åç¼€ã€‚

  ```bash
  $: standard-version -p 'beta'
  # output tag: v1.0.1-beta.0

  $: standard-version -p 'beta'
  # output tag: v1.0.1-0
  ```

- `--dry-run`ï¼šç¼©å†™ `-d`ï¼Œè¿è¡Œ standard-version å‘½ä»¤çš„æ¨¡æ‹Ÿæ¨¡å¼ï¼Œä¸ä¼šå¯¹ä»£ç è¿›è¡Œå®é™…ä¿®æ”¹å’Œæäº¤ã€‚

## ä½¿ç”¨æŠ€å·§

è‹¥æ˜¯åœ¨ package.json ä¸­æ·»åŠ äº†è„šæœ¬å‘½ä»¤

```json
// package.json
"scripts": {
    // other...
    "release": "standard-version"
}
```

åˆ™åœ¨é¡¹ç›®è¿è¡Œæ—¶ï¼Œä¹Ÿå¯æ·»åŠ å®šåˆ¶å‚æ•°ï¼š

```bash
$: npm run release -- --dry-run
```

å…¶ä¸­ï¼Œç¬¬ä¸€ä¸ª `--` æ˜¯ä¸ºäº†å‘Šè¯‰ npm å‘½ä»¤åé¢çš„å‚æ•°å°†ä¼šè¢«ä¼ é€’ç»™æ‰§è¡Œçš„è„šæœ¬ï¼Œè€Œç¬¬äºŒä¸ª `--` æ˜¯ä¸ºäº†å°†å‚æ•°ä¼ é€’ç»™ `npm run release` å‘½ä»¤æ‰€è°ƒç”¨çš„è„šæœ¬ã€‚

å› æ­¤ï¼Œä¸ºäº†å°†å‚æ•°å‡†ç¡®åœ°ä¼ é€’ç»™æ‰§è¡Œçš„è„šæœ¬ï¼Œéœ€è¦åœ¨ npm run å‘½ä»¤åé¢æ·»åŠ ä¸¤ä¸ª `--`ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ª `--` æ˜¯å‘Šè¯‰ npm å‘½ä»¤åé¢çš„å‚æ•°å°†ä¼šè¢«ä¼ é€’ç»™æ‰§è¡Œçš„è„šæœ¬ï¼Œè€Œç¬¬äºŒä¸ª `--` æ˜¯å°†å‚æ•°ä¼ é€’ç»™ npm run å‘½ä»¤æ‰€è°ƒç”¨çš„è„šæœ¬ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæ‰èƒ½å¤Ÿæ­£ç¡®åœ°ä¼ é€’å‚æ•°å¹¶æ‰§è¡Œè„šæœ¬ã€‚
