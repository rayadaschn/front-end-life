---
title: ç›®å½•ç»“æ„åˆ°å¯¹è±¡ç»“æ„
icon: javascript
date: 2024-02-08
category:
  - javascript
tag:
  - javascript
sticky: false
---

åœ¨é¡¹ç›®ç›®å½•ä¸­æˆ‘æœ‰å¦‚ä¸‹ç›®å½•æ–‡ä»¶ï¼Œæƒ³å°†å…¶è½¬åŒ–ä¸ºå¯¹è±¡ç»“æ„ï¼š

```tree
.
â”œâ”€â”€ bar
â”‚   â”œâ”€â”€ a
â”‚   â”‚   â”œâ”€â”€ n1.js
â”‚   â”‚   â””â”€â”€ n2.js
â”‚   â””â”€â”€ b
â”‚       â”œâ”€â”€ n1.js
â”‚       â””â”€â”€ n2.js
â””â”€â”€â”€ foo
   â”œâ”€â”€ a
   â”‚   â”œâ”€â”€ n1.ts
   â”‚   â””â”€â”€ n2.ts
   â””â”€â”€ b
       â”œâ”€â”€ n1.ts
       â””â”€â”€ n2.ts
```

ä»¥ `n1.js` ä¸ºä¾‹ï¼Œå…¶å†…å®¹ä¸ºï¼š

```js
export default {
  m() {
    console.log('n1')
  },
}
```

## ä»£ç å®ç°

```js
const modules = import.meta.glob(['./bar/**/*.js', './foo/**/*.ts'], {
  eager: true, // ç«‹å³åŠ è½½è¿™äº›æ–‡ä»¶ï¼Œè€Œä¸æ˜¯å»¶è¿ŸåŠ è½½
  import: 'default', // å¯¼å…¥æ¨¡å¼
})
console.log('ğŸš€ ~ modules:', modules)

const result = {}

for (const path in modules) {
  const moduleDefault = modules[path] // å®é™…å¯¼å‡ºç»“æœ

  const matched = path.match(/[^\/\.]+/g).slice(0, -1) // æŒ‰è·¯å¾„åˆ†å‰²
  console.log('ğŸš€ ~ matched:', matched)

  let current = result // åˆå§‹ä¸Šå±‚
  for (let i = 0; i < matched.length; i++) {
    const key = matched[i]
    current[key] = current[key] || {} // åˆå§‹åŒ–å±‚çº§

    if (i === matched.length - 1) {
      current[key] = moduleDefault // æœ€åä¸€å±‚èµ‹å€¼
    }

    current = current[key] // æ›´æ–°ä¸Šå±‚
  }
}

console.log('ğŸš€ ~ result:', result)

result.bar.a.n1.m()
```

## æ‰“å°ç»“æœ

```js
{
    "bar": {
        "a": {
            "n1": fn,
            "n2": fn
        },
        "b": {
            "n1": fn,
            "n2": fn
        }
    }
}
```
