---
title: TS æŸ¥æ¼è¡¥ç¼º
icon: javascript
date: 2024-06-03
category:
  - javascript
tag:
  - typescript
---

æœ¬èŠ‚ä¸»è¦æ˜¯å¯¹ typescript çš„æŸ¥æ¼è¡¥ç¼ºï¼Œåœ¨æ­¤ä¹‹å‰çœ‹è¿‡ä¿©ä¸‰éé˜®è€å¸ˆçš„ã€Štypescript æ•™ç¨‹ã€‹ï¼Œä½†è¿˜æ˜¯æœ‰ä¸€äº›çŸ¥è¯†ç‚¹æ²¡æœ‰æŒæ¡ï¼Œå› æ­¤é‡æ–°æ¸©ä¹ ä¸€éï¼Œå¹¶è®°å½•ä¸‹æ¥ã€‚

## æ³›å‹åŠçº¦æŸ

1. æ³›å‹æ˜¯å­˜åœ¨é»˜è®¤å€¼çš„ï¼ŒåŒ js ä¸€æ ·å¯ä»¥èµ‹å€¼é»˜è®¤å€¼ã€‚

   ```ts
   class ArrayList<T = {}> {...}
   ```

   å…¶ä¸­é»˜è®¤ä¸ºå¯¹è±¡æœ€ä¸ºå¸¸è§ï¼Œå½“ç„¶ä¹Ÿæœ‰ä¸€ç§ç‰¹æ®Šæƒ…å†µå°±æ˜¯æ³›å‹çš„ any åŒ–ã€‚

2. æ–­è¨€çš„æ–¹æ³•:
   å¸¸ç”¨çš„æ˜¯ç±»å‹æ–­è¨€ `obj as object` è¿˜æœ‰ä¸€ç§æ˜¯ç±»å‹è½¬æ¢æ–­è¨€ `<object>obj`ï¼Œä¿©è€…æ•ˆæœæ˜¯ä¸€æ ·çš„ã€‚

3. æ³›å‹çº¦æŸ

   `T extends object` æ˜¯ä¸€ä¸ªç±»å‹çº¦æŸï¼Œè¡¨ç¤ºç±»å‹ `T` å¿…é¡»æ˜¯ä¸€ä¸ªå¯¹è±¡ç±»å‹ï¼ˆå³ä¸æ˜¯åŸå§‹ç±»å‹å¦‚ `number`ã€`string`ã€`boolean` ç­‰ï¼‰ã€‚å®ƒå¸¸ç”¨äºæ³›å‹ç±»å‹å‚æ•°çš„çº¦æŸä¸­ï¼Œä»¥ç¡®ä¿ä¼ å…¥çš„ç±»å‹æ˜¯ä¸€ä¸ªå¯¹è±¡ç±»å‹ã€‚

   ```ts
   function logObjectProperties<T extends object>(obj: T): void {
     for (const key in obj) {
       if (obj.hasOwnProperty(key)) {
         console.log(`${key}: ${obj[key]}`)
       }
     }
   }

   // ä½¿ç”¨ç¤ºä¾‹
   logObjectProperties({ name: 'Alice', age: 25 }) // æ­£ç¡®
   // logObjectProperties(42); // é”™è¯¯ï¼Œ42 ä¸æ˜¯ä¸€ä¸ªå¯¹è±¡
   ```

   `T extends keyof U` æ˜¯å¦ä¸€ä¸ªç±»å‹çº¦æŸï¼Œè¡¨ç¤ºç±»å‹ `T` å¿…é¡»æ˜¯ç±»å‹ `U` çš„é”®ï¼ˆkeyï¼‰ä¹‹ä¸€ã€‚å®ƒå¸¸ç”¨äºçº¦æŸæŸä¸ªç±»å‹å¿…é¡»æ˜¯å¦ä¸€ä¸ªç±»å‹çš„é”®åï¼Œç”¨äºè®¿é—®è¯¥ç±»å‹çš„å±æ€§ã€‚

   ```ts
   function getProperty<T, K extends keyof T>(obj: T, key: K): T[K] {
     return obj[key]
   }

   // ä½¿ç”¨ç¤ºä¾‹
   const person = { name: 'Alice', age: 25 }
   const name = getProperty(person, 'name') // æ­£ç¡®ï¼Œ'name' æ˜¯ person çš„é”®
   // const invalid = getProperty(person, 'address'); // é”™è¯¯ï¼Œ'address' ä¸æ˜¯ person çš„é”®
   ```

   é€šå¸¸ä¿©è€…ç»“åˆï¼Œæ•ˆæœæ›´ä½³ï¼š

   ```ts
   class ObjectImpl<T extends object, K extends keyof T> {
     object!: T
     key!: K
     constructor(obj: T, key: K) {
       this.object = obj
       this.key = key
     }
     getValue() {
       return this.object[this.key]
     }
     setValue(value: T[K]) {
       this.object[this.key] = value
     }
     static create<T extends object, K extends keyof T>(
       obj: T,
       key: K
     ): ObjectImpl<T, K> {
       return new ObjectImpl(obj, key)
     }
   }
   ```

4. æ¥å£
   æ¥å£é™¤äº† `interface` å®šä¹‰å¤–ï¼Œä¹Ÿå¯ä»¥ç”¨ `implements` ç»§æ‰¿æ–¹å¼å»å®šä¹‰ã€‚å¦‚`implements List<T>` è¡¨ç¤º `ArrayList` ç±»å®ç°äº† `List` æ¥å£ã€‚`List` ä¹Ÿæ˜¯ä¸€ä¸ªæ³›å‹æ¥å£ï¼Œä½¿ç”¨äº†ç›¸åŒçš„ç±»å‹å‚æ•° `T`ã€‚å®ç°æ¥å£æ„å‘³ç€ `ArrayList` ç±»å¿…é¡»æä¾› `List` æ¥å£ä¸­å®šä¹‰çš„æ‰€æœ‰æ–¹æ³•å’Œå±æ€§ã€‚

   ```ts
   // å®šä¹‰ä¸€ä¸ªæ³›å‹æ¥å£ List
   interface List<T> {
     add(item: T): void
     get(index: number): T
     size(): number
   }

   // å®ç° List æ¥å£çš„ ArrayList ç±»
   class ArrayList<T> implements List<T> {
     private items: T[] = []

     add(item: T): void {
       this.items.push(item)
     }

     get(index: number): T {
       return this.items[index]
     }

     size(): number {
       return this.items.length
     }
   }

   // ä½¿ç”¨
   const numberList: ArrayList<number> = new ArrayList<number>()
   numberList.add(1)
   numberList.add(2)
   console.log(numberList.get(0)) // è¾“å‡º: 1
   console.log(numberList.size()) // è¾“å‡º: 2

   const stringList: ArrayList<string> = new ArrayList<string>()
   stringList.add('hello')
   stringList.add('world')
   console.log(stringList.get(0)) // è¾“å‡º: "hello"
   console.log(stringList.size()) // è¾“å‡º: 2
   ```

   åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼š

   - `List<T>` æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®šä¹‰äº†ä¸‰ä¸ªæ–¹æ³•ï¼š`add(item: T): voidã€get(index: number): T` å’Œ `size(): number`ã€‚
   - `ArrayList<T>` ç±»å®ç°äº† `List<T>` æ¥å£ï¼Œå› æ­¤å®ƒå¿…é¡»æä¾›è¿™ä¸‰ä¸ªæ–¹æ³•çš„å…·ä½“å®ç°ã€‚
   - `ArrayList` ä½¿ç”¨ä¸€ä¸ªå†…éƒ¨æ•°ç»„ `items` æ¥å­˜å‚¨å…ƒç´ ï¼Œå¹¶å®ç°äº† `add`ã€`get` å’Œ `size` æ–¹æ³•ã€‚

5. æ³›å‹

   åœ¨ ts ä¸­ï¼Œæ³›å‹æ˜¯ä¸€ç§å‚æ•°åŒ–çš„ç±»å‹ï¼Œå®ƒå…è®¸æˆ‘ä»¬åœ¨å®šä¹‰å‡½æ•°ã€æ¥å£æˆ–ç±»çš„æ—¶å€™ï¼Œä¸é¢„å…ˆæŒ‡å®šå…·ä½“çš„ç±»å‹ï¼Œè€Œåœ¨ä½¿ç”¨æ—¶å†æŒ‡å®šç±»å‹ã€‚

   ```ts
   /**
    * @description: ä¸­æ–‡æ’åº
    * @param {Array} arr
    * @return {*}
    */
   function compareChinese<T>(arr: Array<T>): T[] {
     return arr.sort((a, b) => {
       return (a as any).localeCompare(b, 'zh-CN')
     })
   }

   /**
    * @description: å¿«é€Ÿæ’åº
    * @param {Array} arr
    * @return {*}
    */
   function quickSort<T>(arr: Array<T>): T[] {
     if (arr.length < 2) return arr

     const left: Array<T> = []
     const right: Array<T> = []
     const mid = arr.splice(Math.floor(arr.length / 2), 1)[0]

     arr.forEach((item) => {
       if (item < mid) {
         left.push(item)
       } else {
         right.push(item)
       }
     })

     return [...quickSort(left), mid, ...quickSort(right)]
   }

   /**
    * @description: å­—ç¬¦ä¸²æ’åº
    * @param {string} str
    * @return {*}
    */
   function strSort(str: string): string {
     return str.split('').sort().join('')
   }

   /**
    * @description: åˆ¤æ–­æ•°ç»„ä¸­æ˜¯å¦å«æœ‰ä¸­æ–‡
    * @param {Array} arr
    * @param {boolean} isEvery
    * @return {*}
    */
   function isChinese(arr: Array<any>, isEvery: boolean = false): boolean {
     return arr[isEvery ? 'every' : 'some']((item) => {
       return /[\u4e00-\u9fa5]/.test(item)
     })
   }

   /**
    * @description: ä¸­æ–‡+è‹±æ–‡/æ•°å­—/å­—ç¬¦ä¸²æ’åº
    * @param {Array} arr
    * @return {*}
    */
   function sortAll<T>(data: T): T[] | string {
     if (data instanceof Array) {
       if (isChinese(data)) {
         return compareChinese(data)
       }
       const resArr: (string | T)[] = data.map((item) => {
         if (typeof item === 'string') {
           return strSort(item)
         }
         return item
       })
       // è¿è¡Œæ—¶åªæœ‰ä¸€ç§ç±»å‹, ç¼–è¯‘æ—¶å­˜åœ¨ä¿©ç§ç±»å‹
       return quickSort(resArr as any)
     }

     return strSort(data as string)
   }

   // æ³›å‹é‡è½½å®ç°
   function sort(data: string): string
   function sort<T>(data: T): T[]
   function sort(data: any): any {
     if (typeof data === 'string') {
       return strSort(data)
     }

     if (data instanceof Array) {
       if (isChinese(data)) {
         return compareChinese(data)
       }
       const resArr = data.map((item) => {
         if (typeof item === 'string') {
           return strSort(item)
         }
         return item
       })
       // è¿è¡Œæ—¶åªæœ‰ä¸€ç§ç±»å‹, ç¼–è¯‘æ—¶å­˜åœ¨ä¿©ç§ç±»å‹
       return quickSort(resArr as any)
     }
   }

   const resNumArr = sort([6, 7, 8, 9, 10, 1, 2, 3, 4, 5])
   console.log('ğŸš€ ~ resNumArr:', resNumArr)
   const resStrArr = sort(['ä¸€', 'äºŒ', 'ä¸‰'])
   console.log('ğŸš€ ~ resStrArr:', resStrArr)
   const resStr = sort('ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹å')
   console.log('ğŸš€ ~ resStr:', resStr)
   ```

6. æ¨æ–­ `infer` çš„å®šä¹‰ï¼š`infer` è¡¨ç¤ºåœ¨ `extends` æ¡ä»¶è¯­å¥ä¸­ä»¥å ä½ç¬¦å‡ºç°çš„ç”¨æ¥ä¿®é¥°æ•°æ®ç±»å‹çš„å…³é”®å­—ï¼Œè¢«ä¿®é¥°çš„æ•°æ®ç±»å‹ç­‰åˆ°ä½¿ç”¨æ—¶æ‰èƒ½è¢«æ¨æ–­å‡ºæ¥ã€‚

   infer å ä½ç¬¦çš„å…³é”®å­—å‡ºç°çš„ä½ç½®ï¼šé€šå¸¸ infer å‡ºç°åœ¨ä»¥ä¸‹ä¸‰ä¸ªä½ç½®ä¸Šï¼š

   1. extends æ¡ä»¶è¯­å¥åçš„å‡½æ•°ç±»å‹çš„å‚æ•°ç±»å‹ä½ç½®ä¸Š;
   2. extends æ¡ä»¶è¯­å¥åçš„å‡½æ•°ç±»å‹çš„è¿”å›å€¼ç±»å‹ä½ç½®ä¸Š;
   3. å‡ºç°åœ¨ç±»å‹çš„æ³›å‹å…·ä½“åŒ–ç±»å‹ä¸Šã€‚

   ```ts
   interface Customer {
     cusName: string
     buyMoney: number
   }

   type cusFuncType = (cus: Customer) => string
   type cusFuncTypeTwo = (cus: Customer, str: string) => string

   // 1. å®šä¹‰: å¦‚æœ T æ˜¯ä¸€ä¸ªå‡½æ•°ç±»å‹ï¼Œå®ƒä¼šæå–å¹¶è¿”å›è¯¥å‡½æ•°çš„å‚æ•°ç±»å‹ï¼›å¦åˆ™ï¼Œå®ƒè¿”å› T æœ¬èº«ã€‚
   // 2. `T extends (params: infer P) => any`ï¼šè¿™æ˜¯ä¸€ä¸ªæ¡ä»¶ç±»å‹ã€‚å®ƒæ£€æŸ¥ T æ˜¯å¦ç¬¦åˆ `(params: infer P) => any` è¿™ä¸ªæ¨¡å¼ï¼Œå³ T æ˜¯å¦æ˜¯ä¸€ä¸ªå‚æ•°ä¸º paramsï¼ˆç±»å‹ä¸º Pï¼‰ï¼Œè¿”å›ç±»å‹ä¸º any çš„å‡½æ•°ç±»å‹ã€‚
   // 3. `infer P` è¡¨ç¤ºæ¨æ–­å‡½æ•°å‚æ•°çš„ç±»å‹å¹¶å°†å…¶èµ‹å€¼ç»™ç±»å‹å˜é‡ P
   type inferType<T> = T extends (params: infer P) => any ? P : T

   // ç¬¦åˆè¦æ±‚
   type inferResultTypeTrue = inferType<cusFuncType> // è¿”å› Customer
   // ä¸ç¬¦åˆè¦æ±‚
   type inferResultTypeFalse = inferType<cusFuncTypeTwo> // è¿”å› { cus: Customer, str: string }
   ```

   ::: tip

   infer å’Œæ³›å‹çš„åŒºåˆ«ï¼š`infer` ä¸»è¦ç”¨äºåœ¨æ¡ä»¶ç±»å‹ä¸­è¿›è¡Œç±»å‹æ¨æ–­ï¼Œå¸®åŠ©æå–å¤æ‚ç±»å‹çš„ä¸€éƒ¨åˆ†ã€‚ä½¿ç”¨æ—¶ç±»å‹ç”±ç¼–è¯‘å™¨è‡ªåŠ¨æ¨æ–­ã€‚**æ— éœ€å®šä¹‰ï¼** ä¸€èˆ¬å‡ºç°åœ¨æ³›å‹çš„å®šä¹‰ä¸­ã€‚

   :::
