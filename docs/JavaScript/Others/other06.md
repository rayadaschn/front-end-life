---
title: é¡µé¢å®‰å…¨ä¹‹æ— é™ Debugger
icon: javascript
date: 2023-11-29
category:
  - javascript
tag:
  - javascript
---

åœ¨è®¿é—®å­—èŠ‚çš„å¤§è¯­è¨€æ¨¡å‹è±†åŒ…çš„æ—¶å€™ï¼Œæ‰“å¼€è°·æ­Œçš„å¼€å‘è€…å·¥å…·åå‘ç°ç›´æ¥å¼¹å‡ºä¸€ä¸ªæ— é™ Debugger å¾ªç¯å‡½æ•°ï¼š

![æ— é™ Debugger](https://cdn.jsdelivr.net/gh/rayadaschn/blogImage@master/img/202311292052407.png)

è¿™ç§æ¨¡å¼é€šå¸¸æ˜¯ä¸ºäº†é˜²æ­¢ç”¨æˆ·è°ƒè¯•é¡µé¢ï¼Œä»¥èµ·åˆ°å®‰å…¨ç­–ç•¥ã€‚æœ¬æ–‡å°±è¿™ä¸ªæŠ€æœ¯æ˜¯å¦‚ä½•å®ç°ä»¥åŠå¦‚ä½•ç ´è§£è¯¥å®‰å…¨ç­–ç•¥å±•å¼€ä¸€äºŒã€‚

## åŸºæœ¬åŸç†

é€šå¸¸å‰ç«¯é¡µé¢ä¸ºäº†é˜²æ­¢ç”¨æˆ·è°ƒè¯•ï¼Œå¸¸ç”¨çš„æ–¹å¼æ˜¯ä¸æ–­è¾“å‡º `debugger` æ¥äº§ç”Ÿæ–­ç‚¹ã€‚é¡µé¢ä¹‹æ‰€ä»¥å¯ä»¥æ­£å¸¸è¿è¡Œæ˜¯ç”±äº `debugger` æ–­ç‚¹åªæœ‰åœ¨æ§åˆ¶å°è¢«æ‰“å¼€æ—¶æ‰ä¼šæ‰§è¡Œã€‚

å½“é¡µé¢è¢«å¡åœ¨ `debugger` æ–­ç‚¹ä¸Šæ—¶ï¼Œç”¨æˆ·æ²¡åŠæ³•è¿›è¡Œè°ƒè¯•ä¹Ÿå°±æ— æ³•æŸ¥è¯¢ç½‘é¡µçš„è¯·æ±‚äº†ã€‚

å› æ­¤å¯ä»¥åœ¨ç½‘é¡µä»£ç ä¸­æ’å…¥å¦‚ä¸‹å®‰å…¨ä»£ç ï¼š

```js
/**
 * åŸºç¡€ç¦æ­¢è°ƒè¯•ä»£ç 
 */
;(() => {
  function ban() {
    setInterval(() => {
      debugger
    }, 50)
  }
  try {
    ban()
  } catch (err) {}
})()
```

## åº”å¯¹ç­–ç•¥

å¯¹äºè¿™ç§æ— é™ debuggerï¼Œå®é™…ä¸Šæ˜¯å¯ä»¥è§£å†³çš„ã€‚åœ¨æ§åˆ¶å°ä¸Šæ–­ç‚¹è°ƒè¯•æŒ‰é’®çš„æœ€å³è¾¹æœ‰ä¸€ä¸ª `Deactivate breakpoints` åœç”¨æ–­ç‚¹æŒ‰é’®ï¼ŒæŒ‰ä¸‹å®ƒä¾¿å¯å…³é—­æ— çº¿ debugger äº†ã€‚

![Deactivate breakpoints æŒ‰é’®](https://cdn.jsdelivr.net/gh/rayadaschn/blogImage@master/img/202311292102838.png)

## åœ¨é¡¹ç›®ä¸­åŠ å…¥è¯¥å®‰å…¨ç­–ç•¥

ä¸ºäº†è®©æˆ‘ä»¬çš„ debugger ä»£ç ä¸æ˜¯é‚£ä¹ˆçš„æ˜æ˜¾ï¼ˆè®©ç”¨æˆ·çœ‹ä¸å‡ºä»£ç æ‰§è¡Œç­–ç•¥ o(â•¥ï¹â•¥)oï¼‰ï¼Œå¯ä»¥å¯¹ä¸Šè¿°ä»£ç è¿›è¡Œä¸€å®šçš„æ”¹é€ ã€‚

### ç‰ˆæœ¬ 1

> é€šè¿‡å°† `debugger` æ”¹å†™æˆ `Function("debugger")();` çš„å½¢å¼ã€‚

åˆ©ç”¨ Function æ„é€ å‡½æ•°ç”Ÿæˆä¸€ä¸ª debugger å‡½æ•°ï¼Œè€Œåå†ç«‹å³æ‰§è¡Œï¼Œæ¥å®ç°ã€‚

**åŸç†ï¼š**

`Function` æ˜¯ JavaScript ä¸­çš„ä¸€ä¸ªå†…ç½®æ„é€ å‡½æ•°ï¼Œç”¨äºåˆ›å»ºæ–°çš„å‡½æ•°å¯¹è±¡ã€‚å®ƒçš„è¯­æ³•æ˜¯ï¼š

```javascript
new Function([arg1[, arg2[, ...argN]],] functionBody)
```

- `arg1, arg2, ...argN` æ˜¯å‡½æ•°çš„å‚æ•°ï¼Œå¯ä»¥æœ‰é›¶ä¸ªæˆ–å¤šä¸ªã€‚
- `functionBody` æ˜¯ä¸€ä¸ªåŒ…å«å‡½æ•°å®šä¹‰çš„å­—ç¬¦ä¸²ï¼Œå³å‡½æ•°ä½“ã€‚

ä¾‹å¦‚ï¼š

```javascript
const add = new Function('a', 'b', 'return a + b')
console.log(add(2, 3)) // è¾“å‡º 5
```

ä¸Šè¿°ä»£ç é€šè¿‡ `Function` æ„é€ å‡½æ•°åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„å‡½æ•° `add`ï¼Œå®ƒæ¥å—ä¸¤ä¸ªå‚æ•° `a` å’Œ `b`ï¼Œå¹¶è¿”å›å®ƒä»¬çš„å’Œã€‚

**æ³¨æ„äº‹é¡¹ï¼š**

1. ä½¿ç”¨ `Function` æ„é€ å‡½æ•°åˆ›å»ºçš„å‡½æ•°å¯¹è±¡æ²¡æœ‰è¯æ³•ä½œç”¨åŸŸï¼Œå®ƒä»¬åœ¨å…¨å±€ä½œç”¨åŸŸä¸­åˆ›å»ºã€‚è¿™æ„å‘³ç€å®ƒä»¬æ— æ³•ç›´æ¥è®¿é—®å®ƒä»¬è¢«åˆ›å»ºæ—¶æ‰€åœ¨çš„ä½œç”¨åŸŸçš„å˜é‡ã€‚
2. åˆ›å»ºå‡½æ•°çš„æ–¹å¼æœ‰å¾ˆå¤šç§ï¼Œé€šå¸¸ä½¿ç”¨å‡½æ•°å£°æ˜æˆ–å‡½æ•°è¡¨è¾¾å¼å°±è¶³å¤Ÿäº†ã€‚`Function` æ„é€ å‡½æ•°é€šå¸¸ç”¨äºåŠ¨æ€ç”Ÿæˆå‡½æ•°ä»£ç ï¼Œä½†åœ¨ç»å¤§å¤šæ•°æƒ…å†µä¸‹æ˜¯ä¸å¿…è¦çš„ã€‚

**æœ€ç»ˆä»£ç ï¼š**

```js
/** åŠ å¯†å‰ */
;(() => {
  function ban() {
    setInterval(() => {
      Function('debugger')()
    }, 50)
  }
  try {
    ban()
  } catch (err) {}
})()

/** åŠ å¯†å */
eval(
  (function (c, g, a, b, d, e) {
    d = String
    if (!''.replace(/^/, String)) {
      for (; a--; ) e[a] = b[a] || a
      b = [
        function (f) {
          return e[f]
        },
      ]
      d = function () {
        return 'w+'
      }
      a = 1
    }
    for (; a--; )
      b[a] && (c = c.replace(new RegExp('\b' + d(a) + '\b', 'g'), b[a]))
    return c
  })(
    '(()=>{1 0(){2(()=>{3("4")()},5)}6{0()}7(8){}})();',
    9,
    9,
    'block function setInterval Function debugger 50 try catch err'.split(' '),
    0,
    {}
  )
)
```

### ç‰ˆæœ¬ 2

ä¸ºäº†è®©ä¸Šè¿°ä»£ç æ›´åŠ éš¾æ‡‚ï¼Œå¯ä»¥å†åº¦ä¸‘åŒ–ã€‚

> å°† `Function('debugger').call()` æ”¹æˆ `(function(){return false;})['constructor']('debugger')['call']();`

å³ï¼š

```js
;(() => {
  function block() {
    setInterval(() => {
      ;(function () {
        return false
      })
        ['constructor']('debugger')
        ['call']()
    }, 50)
  }
  try {
    block()
  } catch (err) {}
})()
```

**å®ç°åŸç†ï¼š**

åœ¨ JavaScript ä¸­ï¼Œå‡½æ•°æ˜¯ä¸€ç§ç‰¹æ®Šçš„å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå‡½æ•°å¯ä»¥æ‹¥æœ‰å±æ€§ã€‚å…¶ä¸­ï¼Œä¸€ä¸ªå±æ€§å°±æ˜¯ `constructor`ï¼Œå®ƒæŒ‡å‘åˆ›å»ºè¯¥å‡½æ•°çš„æ„é€ å‡½æ•°ï¼Œé€šå¸¸æ˜¯ `Function`ã€‚

ç°åœ¨ï¼Œè®©æˆ‘ä»¬è¯¦ç»†è§£é‡Šä¸ºä»€ä¹ˆåœ¨è¿™ä¸ªä»£ç ç‰‡æ®µä¸­ä½¿ç”¨ `('debugger')` ä¼šåˆ›å»ºä¸€ä¸ªåŒ…å« `debugger;` è¯­å¥çš„æ–°åŒ¿åå‡½æ•°ã€‚

1. `(function(){return false;})`ï¼šè¿™æ˜¯ä¸€ä¸ªåŒ¿åçš„è‡ªæ‰§è¡Œå‡½æ•°ï¼Œå®ƒè¿”å› `false`ã€‚è¿™ä¸ªå‡½æ•°æ˜¯ä¸€ä¸ªæ™®é€šçš„ JavaScript å‡½æ•°ã€‚

2. `['constructor']`ï¼šé€šè¿‡ä½¿ç”¨æ•°ç»„è®¿é—®è¯­æ³•ï¼Œæˆ‘ä»¬è·å–äº†ä¸Šé¢å‡½æ•°å¯¹è±¡çš„ `constructor` å±æ€§ã€‚è¿™ä¸ªå±æ€§æŒ‡å‘å‡½æ•°å¯¹è±¡çš„æ„é€ å‡½æ•°ï¼Œé€šå¸¸æ˜¯ `Function`ã€‚

3. `('debugger')`ï¼šç°åœ¨ï¼Œæˆ‘ä»¬è°ƒç”¨äº† `Function` æ„é€ å‡½æ•°ï¼Œå®ƒçš„å‚æ•°æ˜¯å­—ç¬¦ä¸² `'debugger'`ã€‚åœ¨ JavaScript ä¸­ï¼Œ`Function` æ„é€ å‡½æ•°æ¥å—ä¸€ç³»åˆ—å­—ç¬¦ä¸²ä½œä¸ºå‚æ•°ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªæ–°çš„å‡½æ•°ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä¼ é€’äº†å­—ç¬¦ä¸² `'debugger'`ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²åŒ…å«äº†ä¸€ä¸ª JavaScript è¯­å¥ï¼Œå³ `debugger;`ã€‚

4. `['call']`ï¼šé€šè¿‡æ•°ç»„è®¿é—®è¯­æ³•ï¼Œæˆ‘ä»¬è·å–äº†ä¸Šä¸€æ­¥åˆ›å»ºçš„æ–°å‡½æ•°çš„ `call` æ–¹æ³•ã€‚`call` æ–¹æ³•æ˜¯ JavaScript ä¸­å‡½æ•°å¯¹è±¡çš„ä¸€ä¸ªæ–¹æ³•ï¼Œå®ƒå…è®¸æˆ‘ä»¬è°ƒç”¨ä¸€ä¸ªå‡½æ•°ï¼Œå¹¶è®¾ç½®å‡½æ•°ä½“å†…çš„ `this` å€¼ã€‚

5. `()`ï¼šæœ€ç»ˆï¼Œæˆ‘ä»¬é€šè¿‡è°ƒç”¨ `call` æ–¹æ³•ï¼Œæ‰§è¡Œäº†è¿™ä¸ªæ–°åˆ›å»ºçš„å‡½æ•°ï¼Œå¹¶ä¸”ç”±äºå®ƒçš„å‡½æ•°ä½“æ˜¯ `debugger;`ï¼Œæ‰€ä»¥ `debugger;` è¯­å¥è¢«æ‰§è¡Œã€‚

å¥½äº†ï¼Œç”±æ­¤å¾—åˆ°äº†ä¸€ä¸ªä¸æ˜¯å¾ˆèƒ½ä¸€çœ¼çœ‹æ‡‚çš„å®‰å…¨ä»£ç å—ï¼Œå½“ç„¶è¿˜å¯ä»¥åœ¨æ­¤åŸºç¡€ä¸Šå¢åŠ å…¶å®ƒå†…å®¹ï¼Œå¦‚å½“çª—å£å¤–éƒ¨å®½é«˜å’Œå†…éƒ¨å®½é«˜çš„å·®å€¼å¤§äºä¸€å®šçš„å€¼ ï¼Œå¯ä»¥å°† body é‡Œçš„å†…å®¹æ¢æˆæŒ‡å®šå†…å®¹ï¼Œä»¥æ­¤é˜²æ­¢ç”¨æˆ·â€œå·çª¥â€ã€‚

**æœ€ç»ˆä»£ç ï¼š**

```js
;(() => {
  function block() {
    if (
      window.outerHeight - window.innerHeight > 200 ||
      window.outerWidth - window.innerWidth > 200
    ) {
      document.body.innerHTML = 'æ£€æµ‹åˆ°éæ³•è°ƒè¯•,è¯·å…³é—­ååˆ·æ–°é‡è¯•!'
    }
    setInterval(() => {
      ;(function () {
        return false
      })
        ['constructor']('debugger')
        ['call']()
    }, 50)
  }
  try {
    block()
  } catch (err) {}
})()
```

## å…¶å®ƒæ–¹æ³•

æœ‰æ²¡æœ‰å…¶å®ƒæ›´ç›´æ¥çš„æ–¹æ³•ï¼Ÿç­”æ¡ˆæ˜¯æœ‰çš„ï¼Œ[console-ban](https://github.com/fz6m/console-ban)ï¼Œå®é™…ä¸Šå¼€å¤´çš„è±†åŒ…ä¹Ÿæ˜¯ä½¿ç”¨çš„è¿™ä¸ªåº“ã€‚

ä½¿ç”¨æ–¹æ³•éå¸¸ç®€å•ï¼š

```bash
$: npm install console-ban
```

è€Œååœ¨ `main.js` ä¸­åŠ å…¥ï¼š

```js
import { init } from 'console-ban'

init(options)
```

### Options

|    name     | required |       type        | default | description                                                 |
| :---------: | :------: | :---------------: | :-----: | :---------------------------------------------------------- |
|   `clear`   |    no    |      boolean      | `true`  | ç¦ç”¨ `console.clear` å‡½æ•°                                   |
|   `debug`   |    no    |      boolean      | `true`  | æ˜¯å¦å¼€å¯å®šæ—¶ `debugger` åçˆ¬è™«å®¡æŸ¥                          |
| `debugTime` |    no    |      number       | `3000`  | å®šæ—¶ `debugger` æ—¶é—´é—´éš”ï¼ˆæ¯«ç§’ï¼‰                            |
| `redirect`  |    no    |      string       |   `-`   | å¼€å¯æ§åˆ¶å°åé‡å®šå‘åœ°å€                                      |
|   `write`   |    no    | string \| Element |   `-`   | å¼€å¯æ§åˆ¶å°åé‡å†™ `document.body` å†…å®¹ï¼Œæ”¯æŒä¼ å…¥èŠ‚ç‚¹æˆ–å­—ç¬¦ä¸² |
| `callback`  |    no    |     Function      |   `-`   | å¼€å¯æ§åˆ¶å°åçš„å›è°ƒå‡½æ•°                                      |
|  `bfcache`  |    no    |      boolean      | `true`  | ç¦ç”¨ `bfcache` åŠŸèƒ½                                         |

æ³¨ï¼š`redirect`ã€`write`ã€`callback` ä¸‰ç§ç­–ç•¥åªèƒ½å–å…¶ä¸€ï¼Œä¼˜å…ˆä½¿ç”¨å›è°ƒå‡½æ•°ã€‚

ç¬”è€…åˆ™æ˜¯åœ¨ `index.html` ä¸­ç›´æ¥å¼•å…¥:

```html
<head>
  <!-- ... -->
  <script src="https://cdn.jsdelivr.net/npm/console-ban@5.0.0/dist/console-ban.min.js"></script>
  <script>
    ConsoleBan.init({
      debug: true, // options å¼€å¯ debugger æ¨¡å¼
    })
  </script>
</head>
```

ä¾¿å¯ä»¥è¾¾åˆ°è±†åŒ…çš„æ•ˆæœã€‚å…¶å®ƒæ•ˆæœå¦‚é‡å†™ `body` åˆ™å¯ä½¿ç”¨ `write` options æ”¹å†™æˆè‡ªå·±æƒ³è¦çš„ bodyã€‚

æ€»ä½“æ¥è¯´ [console-ban](https://github.com/fz6m/console-ban) è¿˜æ˜¯å¾ˆå¥½ç”¨çš„ã€‚æ¨è ğŸ‘ğŸ»

## å‚è€ƒæ–‡ç« 

- [ã€Šç¦æ­¢åˆ«äººè°ƒè¯•è‡ªå·±çš„å‰ç«¯é¡µé¢ä»£ç ã€‹](https://juejin.cn/post/7262175454714626108?searchId=20231129095552A38D1FFBA67A7DCC8404)
